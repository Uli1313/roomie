<nav class="navbar navbar-expand-md bg-white border-bottom">
  <div class="container-xxl">
    <div class="flex-grow-1">
      <a class="navbar-brand order-0" href="index.html">
        <picture>
          <source srcset="/assets/images/logo.png" media="(min-width:768px)" />
          <img
            src="/assets/images/mobile/logo-mobile.png"
            alt="roomie 屋伴"
            class="logo"
          />
        </picture>
      </a>
    </div>
    <div class="d-flex order-1 order-md-2">
      <ul class="d-flex ms-5 gap-0 gap-md-5">
        <!-- mobile notification icon -->
        <li>
          <a
            class="p-3 link-dark hover-primary border-0 rounded-3 d-md-none"
            data-bs-toggle="offcanvas"
            href="#offcanvasExample"
            role="button"
            aria-controls="offcanvasExample"
            ><span class="material-icons"> notifications_active </span></a
          >
        </li>
        <!-- desktop notification dropdown -->
        <li class="navbar-notification nav-item dropdown d-none d-md-block">
          <a
            class="nav-link dropdown-toggle p-3 link-dark hover-primary border-0 rounded-3"
            href="#"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="material-icons"> notifications_active </span>
          </a>
          <ul class="dropdown-menu" style="width: 526px">
            <div
              class="card bg-white rounded-0 hover-light border-0 border-bottom"
            >
              <div class="d-flex g-0 align-items-center ps-5">
                <img
                  src="/assets/images/room-1.png"
                  class="img-fluid notification-img"
                  alt="..."
                />
                <div class="card-body pt-3 pe-5 pb-3 ps-4">
                  <p class="card-text fs-6 mb-4">
                    您收藏的<span class="fw-bold"
                      >「極簡黑白共生宅民生東路電梯大樓」</span
                    >文章有新的回覆。
                  </p>
                  <p class="fs-7">16小時前</p>
                </div>
              </div>
              <a href="#" class="stretched-link"></a>
            </div>
            <div
              class="card bg-white rounded-0 hover-light border-0 border-bottom"
            >
              <div class="d-flex g-0 align-items-center ps-5">
                <img
                  src="/assets/images/room-1.png"
                  class="img-fluid notification-img"
                  alt="..."
                />
                <div class="card-body pt-3 pe-5 pb-3 ps-4">
                  <p class="card-text fs-6 mb-4">
                    您收藏的<span class="fw-bold"
                      >「極簡黑白共生宅民生東路電梯大樓」</span
                    >文章有新的回覆。
                  </p>
                  <p class="fs-7">16小時前</p>
                </div>
              </div>
              <a href="#" class="stretched-link"></a>
            </div>
            <div
              class="card bg-white rounded-0 hover-light border-0 border-bottom"
            >
              <div class="d-flex g-0 align-items-center ps-5">
                <img
                  src="/assets/images/alert.png"
                  class="img-fluid notification-img"
                  alt="..."
                />
                <div class="card-body pt-3 pe-5 pb-3 ps-4">
                  <p class="card-text fs-6 mb-4">
                    提醒您，違規達三次(含)將停權帳號，發表文章時請務必遵守規範。
                  </p>
                  <p class="fs-7">16小時前</p>
                </div>
              </div>
              <a href="#" class="stretched-link"></a>
            </div>
            <div
              class="card bg-white rounded-0 hover-light border-0 border-bottom"
            >
              <div class="d-flex g-0 align-items-center ps-5">
                <img
                  src="/assets/images/alert.png"
                  class="img-fluid notification-img"
                  alt="..."
                />
                <div class="card-body pt-3 pe-5 pb-3 ps-4">
                  <p class="card-text fs-6 mb-4">
                    提醒您，違規達三次(含)將停權帳號，發表文章時請務必遵守規範。
                  </p>
                  <p class="fs-7">16小時前</p>
                </div>
              </div>
              <a href="#" class="stretched-link"></a>
            </div>
            <div
              class="card bg-white rounded-0 hover-light border-0 border-bottom"
            >
              <div class="d-flex g-0 align-items-center ps-5">
                <img
                  src="/assets/images/alert.png"
                  class="img-fluid notification-img"
                  alt="..."
                />
                <div class="card-body pt-3 pe-5 pb-3 ps-4">
                  <p class="card-text fs-6 mb-4">
                    您發表的<span class="fw-bold"
                      >「台中市區找人合租工作室」</span
                    >文章，因違反規範「 第 4 條
                    禁止包含廣告、商業宣傳之內容。」，管理者已將您的文章移除。
                  </p>
                  <p class="fs-7">16小時前</p>
                </div>
              </div>
              <a href="#" class="stretched-link"></a>
            </div>
            <a
              class="fs-7 fw-bold text-center text-secondary bg-white py-3 hover-light d-block"
              href="#"
              >查看全部</a
            >
          </ul>
        </li>
        <!-- mobile account icon -->
        <li
          class="collapsed d-md-none"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#accountMenu"
          aria-controls="accountMenu"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <a
            class="nav-unlogged p-3 link-dark hover-primary border-0 rounded-3"
            href="#"
          >
            <span class="material-icons-outlined"> account_circle </span></a
          >
          <a
            class="nav-logged p-3 link-dark hover-primary border-0 rounded-3"
            href="#"
          >
            <img
              class="nav-logged-photo nav-logged-photo-mobile rounded-circle overflow-hidden object-fit-cover"
              src=""
              alt="user-photo"
            />
          </a>
        </li>
        <!-- desktop accountMenu icon & dropdown-->
        <li class="navbar-account nav-item dropdown d-none d-md-block">
          <a
            class="nav-unlogged nav-link dropdown-toggle p-3 link-dark hover-primary border-0 rounded-3"
            href="#"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="material-icons-outlined"> account_circle </span>
          </a>
          <a
            class="nav-logged nav-link p-0 dropdown-togglelink-dark hover-primary border-0 d-none"
            href="#"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <img
              class="nav-logged-photo rounded-circle overflow-hidden object-fit-cover"
              src=""
              alt="user-photo"
            />
          </a>
          <!-- desktop accountMenu dropdown -->
          <ul class="dropdown-menu" style="width: 220px">
            <!-- desktop accountMenu dropdown 未登入 -->
            <li class="nav-unlogged">
              <a class="dropdown-item rounded-top" href="login.html">登入</a>
            </li>
            <li class="nav-unlogged">
              <a
                class="dropdown-item border-0 rounded-bottom"
                href="signup.html"
                >註冊</a
              >
            </li>
            <!-- desktop accountMenu dropdown 已登入 -->
            <li class="nav-logged">
              <a class="dropdown-item rounded-top" href="user.html">會員專區</a>
            </li>
            <li class="nav-logged">
              <a class="dropdown-item" href="user_posts.html">發文列表</a>
            </li>
            <li class="nav-logged">
              <a class="dropdown-item" href="user_favorites.html">收藏列表</a>
            </li>
            <li class="nav-logged">
              <a class="dropdown-item" href="user_messages.html">留言列表</a>
            </li>
            <li class="nav-logged">
              <a class="dropdown-item border-0 rounded-bottom" href="login.html"
                >登出</a
              >
            </li>
          </ul>
        </li>
      </ul>
      <button
        class="navbar-toggler order-3 border-0 hover-primary"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#burgurMenu"
        aria-controls="burgurMenu"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="material-icons-outlined"> menu </span>
      </button>
    </div>
    <!-- desktop & mobile menu -->
    <div
      class="collapse navbar-collapse flex-grow-0 order-2 order-md-1 z-3 border-bottom border-bottom-md-0"
      id="burgurMenu"
    >
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="news.html">最新消息</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="rentList.html">合租清單</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="matchList.html">媒合成功</a>
        </li>
        <li
          class="nav-item d-md-none"
          data-bs-toggle="collapse"
          data-bs-target="#burgurMenu"
          aria-controls="burgurMenu"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <a class="nav-link border-0 text-center" href="#"
            ><span class="material-icons-outlined"> close </span></a
          >
        </li>
      </ul>
    </div>
    <!-- mobile accountMenu 已登入 -->
    <div class="nav-logged d-md-none">
      <div
        class="accountMenu collapse navbar-collapse flex-grow-0 order-2 order-md-1 z-3 border-bottom"
        id="accountMenu"
      >
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="user.html">會員專區</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="user_posts.html">發文列表</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">收藏列表</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="user_messages.html">留言列表</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="login.html">登出</a>
          </li>
          <li
            class="nav-item"
            data-bs-toggle="collapse"
            data-bs-target="#accountMenu"
            aria-controls="accountMenu"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <a class="nav-link border-0 text-center" href="#"
              ><span class="material-icons-outlined"> close </span></a
            >
          </li>
        </ul>
      </div>
    </div>
    <!-- mobile accountMenu 未登入 -->
    <div class="nav-unlogged d-none">
      <div
        class="accountMenu collapse navbar-collapse flex-grow-0 order-2 order-md-1 z-3 border-bottom"
        id="accountMenu"
      >
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="login.html">登入</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="signup.html">註冊</a>
          </li>
          <li
            class="nav-item"
            data-bs-toggle="collapse"
            data-bs-target="#accountMenu"
            aria-controls="accountMenu"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <a class="nav-link border-0 text-center" href="#"
              ><span class="material-icons-outlined"> close </span></a
            >
          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<!-- mobile notification -->
<div
  class="notification offcanvas offcanvas-start d-md-none"
  tabindex="-1"
  id="offcanvasExample"
  aria-labelledby="offcanvasExampleLabel"
>
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasExampleLabel">通知列表</h5>
    <span
      class="material-icons text-white p-3"
      type="button"
      class="btn-close"
      data-bs-dismiss="offcanvas"
      aria-label="Close"
    >
      close
    </span>
  </div>
  <div class="offcanvas-body">
    <div class="card bg-white rounded-0 hover-light border-0 border-bottom">
      <div class="d-flex g-0 align-items-center ps-5">
        <img
          src="/assets/images/room-1.png"
          class="img-fluid notification-img"
          alt="..."
        />
        <div class="card-body pt-3 pe-5 pb-3 ps-4">
          <p class="card-text fs-7 mb-4">
            您收藏的<span class="fw-bold"
              >「極簡黑白共生宅民生東路電梯大樓」</span
            >文章有新的回覆。
          </p>
          <p class="fs-8">16小時前</p>
        </div>
      </div>
      <a href="#" class="stretched-link"></a>
    </div>
    <div class="card bg-white rounded-0 hover-light border-0 border-bottom">
      <div class="d-flex g-0 align-items-center ps-5">
        <img
          src="/assets/images/room-1.png"
          class="img-fluid notification-img"
          alt="..."
        />
        <div class="card-body pt-3 pe-5 pb-3 ps-4">
          <p class="card-text fs-7 mb-4">
            您收藏的<span class="fw-bold"
              >「極簡黑白共生宅民生東路電梯大樓」</span
            >文章有新的回覆。
          </p>
          <p class="fs-8">16小時前</p>
        </div>
      </div>
      <a href="#" class="stretched-link"></a>
    </div>
    <div class="card bg-white rounded-0 hover-light border-0 border-bottom">
      <div class="d-flex g-0 align-items-center ps-5">
        <img
          src="/assets/images/room-1.png"
          class="img-fluid notification-img"
          alt="..."
        />
        <div class="card-body pt-3 pe-5 pb-3 ps-4">
          <p class="card-text fs-7 mb-4">
            您收藏的<span class="fw-bold"
              >「極簡黑白共生宅民生東路電梯大樓」</span
            >文章有新的回覆。
          </p>
          <p class="fs-8">16小時前</p>
        </div>
      </div>
      <a href="#" class="stretched-link"></a>
    </div>
    <div class="card bg-white rounded-0 hover-light border-0 border-bottom">
      <div class="d-flex g-0 align-items-center ps-5">
        <img
          src="/assets/images/alert.png"
          class="img-fluid notification-img"
          alt="..."
        />
        <div class="card-body pt-3 pe-5 pb-3 ps-4">
          <p class="card-text fs-7 mb-4">
            提醒您，違規達三次(含)將停權帳號，發表文章時請務必遵守規範。
          </p>
          <p class="fs-8">16小時前</p>
        </div>
      </div>
      <a href="#" class="stretched-link"></a>
    </div>
    <div class="card bg-white rounded-0 hover-light border-0 border-bottom">
      <div class="d-flex g-0 align-items-center ps-5">
        <img
          src="/assets/images/alert.png"
          class="img-fluid notification-img"
          alt="..."
        />
        <div class="card-body pt-3 pe-5 pb-3 ps-4">
          <p class="card-text fs-7 mb-4">
            提醒您，違規達三次(含)將停權帳號，發表文章時請務必遵守規範。
          </p>
          <p class="fs-8">16小時前</p>
        </div>
      </div>
      <a href="#" class="stretched-link"></a>
    </div>
    <div class="card bg-white rounded-0 hover-light border-0 border-bottom">
      <div class="d-flex g-0 align-items-center ps-5">
        <img
          src="/assets/images/alert.png"
          class="img-fluid notification-img"
          alt="..."
        />
        <div class="card-body pt-3 pe-5 pb-3 ps-4">
          <p class="card-text fs-7 mb-4">
            您發表的<span class="fw-bold">「台中市區找人合租工作室」</span
            >文章，因違反規範「 第 4 條
            禁止包含廣告、商業宣傳之內容。」，管理者已將您的文章移除。
          </p>
          <p class="fs-8">16小時前</p>
        </div>
      </div>
      <a href="#" class="stretched-link"></a>
    </div>
  </div>
  <a
    class="fs-7 fw-bold text-center text-secondary bg-white py-3 border-top hover-light"
    href="#"
    >查看全部</a
  >
</div>

<script type="module">
  import axios from "axios";

  const baseUrl = "https://roomie-lfta.onrender.com";
  // const baseUrl = "http://localhost:3000";

  const localUserId = localStorage.getItem("userId");
  const localUserToken = localStorage.getItem("token");

  const token = {
    headers: {
      Authorization: `Bearer ${localUserToken}`,
    },
  };

  let user;

  const navLogged = document.querySelectorAll(".nav-logged");
  const navUnLogged = document.querySelectorAll(".nav-unlogged");
  const navLoggedPhoto = document.querySelectorAll(".nav-logged-photo");

  (async () => {
    try {
      const apiPath = `/600/users/${localUserId}`;
      const apiUrl = `${baseUrl}${apiPath}`;
      const response = await axios.get(apiUrl, token);
      const photoUrl = response.data.photo;

      navLoggedPhoto.forEach((e) => e.setAttribute("src", photoUrl));
      user = response.data;
      updateLocalStorage(); // 用最新的用戶資料更新 localStorage
      navLogged.forEach((e) => {
        e.classList.remove("d-none");
      });
      navUnLogged.forEach((e) => {
        e.classList.add("d-none");
      });
      console.log("已登入");
    } catch (err) {
      console.log(err);
      navLogged.forEach((e) => {
        e.classList.add("d-none");
      });
      navUnLogged.forEach((e) => {
        e.classList.remove("d-none");
      });
      console.log("未登入");
    }
  })();

  // 用最新的用戶資料更新 localStorage
  function updateLocalStorage() {
    localStorage.setItem("user", JSON.stringify(user));
  }
</script>
