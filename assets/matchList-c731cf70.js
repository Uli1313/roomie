import{a as u}from"./bootstrap.min-f14bc68a.js";const j="https://roomie-lfta.onrender.com",z=localStorage.getItem("userId"),B=localStorage.getItem("token"),F={headers:{Authorization:`Bearer ${B}`}};let I;const U=document.querySelectorAll(".nav-logged"),M=document.querySelectorAll(".nav-unlogged"),V=document.querySelectorAll(".nav-logged-photo");(async()=>{try{const n=`/600/users/${z}`,a=`${j}${n}`,r=await u.get(a,F),i=r.data.photo;V.forEach(o=>o.setAttribute("src",i)),I=r.data,J(),U.forEach(o=>{o.classList.remove("d-none")}),M.forEach(o=>{o.classList.add("d-none")}),console.log("已登入")}catch(n){console.log(n),U.forEach(a=>{a.classList.add("d-none")}),M.forEach(a=>{a.classList.remove("d-none")}),console.log("未登入")}})();function J(){localStorage.setItem("user",JSON.stringify(I))}const b="https://roomie-lfta.onrender.com/";let t="",p=[];function W(n){let a=document.querySelector("#list"),r="";n.forEach(function(i){const o=`${i.updateDate}`,k=new Date(o),v=`${i.soldDate}`,$=new Date(v),_=new Date,x=k.getTime()-$.getTime(),c=$.getTime()-_.getTime(),L=Math.abs(Math.trunc(x/(1e3*3600*24))),e=Math.abs(Math.trunc(c/(1e3*3600*24)));r+=`<div class="col-12 my-3 p-1 hover-primary-2 rounded">
                    <div class="col-12 p-3 bg-white d-flex flex-wrap justify-content-evenly align-items-center text-end text-lg-center border rounded">
                        <div class="col-12 col-lg-4"><a href="matchArticle.html?id=${i.id}" class="link-dark fw-bold">${i.title}</a></div>
                        <div class="col-12 col-lg pb-1 pb-lg-0"><span class="text-primary">${e}日前&nbsp;</span>媒合成功</div>
                        <div class="col-12 col-lg pb-1 pb-lg-0">${i["square Footage"]}坪&nbsp;/&nbsp;${i.type}</div>
                        <div class="col-12 col-lg fw-bold text-primary">${i.price.toLocaleString("zh-TW")}元/月</div>
                        <div class="col-12 col-lg">
                            <span class="text-primary">花費${L}日&nbsp;</span>
                            媒合成功
                            <span class="material-symbols-outlined ps-1 text-danger" style="transform: translateY(24%);">verified</span>
                        </div>
                    </div>
                </div>
                `}),a.innerHTML=r,ae()}function C(){let n=document.querySelector("#list"),a=`
                <div class="row rounded">
                    <div class="col bg-white rounded m-5 p-5 d-flex flex-column justify-content-center align-items-center ">
                        <p>¯_(ツ)_/¯</p>
                        <p class="p-2 h5">對不起，沒有找到適合您的物件！</p>
                        <p>建議您：重新篩選或搜尋試試看唷～</p>
                    </div>
                </div>`;n.innerHTML=a}function Y(){t="_sort=view&_order=desc&status=已媒合",u.get(`${b}rents?${t}`).then(function(n){p=n.data,y(t,s,g),f(p)})}Y();let G=document.querySelector("#filterDate"),K=document.querySelector("#filterPrice"),h="&_sort=soldDate&_order=asc",q="&_sort=soldDate&_order=desc",m="&_sort=price&_order=asc",w="&_sort=price&_order=desc",E="_sort=view&_order=desc";function Q(){G.addEventListener("click",function(n){t.includes(h)?t=t.replace(h,q):t.includes(q)?t=t.replace(q,h):t.includes(m)?t=t.replace(m,h):t.includes(w)?t=t.replace(w,h):t.includes(E)?t=t.replace(E,h):t+=h,u.get(`${b}rents?${t}`).then(function(a){p=a.data,p.length>0?(y(t,1,g),s=1,f(p)):(C(),s=1,f(p))})})}Q();function X(){K.addEventListener("click",function(n){t.includes(m)?t=t.replace(m,w):t.includes(w)?t=t.replace(w,m):t.includes(h)?t=t.replace(h,m):t.includes(q)?t=t.replace(q,m):t.includes(E)?t=t.replace(E,m):t+=m,u.get(`${b}rents?${t}`).then(function(a){p=a.data,p.length>0?(y(t,1,g),s=1,f(p)):(C(),s=1,f(p))})})}X();let T,D,g=4,s=1,R=document.querySelector(".pagination");function y(n,a,r){u.get(`${b}rents?${n}&_page=${a}&_limit=${r}`).then(i=>{let o=i.data;W(o)})}function f(n){T=n.length,D=Math.ceil(T/g);let a="";if(T==0)a="";else{a+=`<li class="page-item">
        <a class="page-link" href="#" aria-label="Previous">
            <span class="material-icons align-bottom">
            chevron_left
            </span>
        </a>
        </li>`;for(let i=1;i<=D;i++)a+=`<li class="page-item">
            <a class="page-link" href="#">${i}</a>
        </li>`;a+=`<li class="page-item">
        <a class="page-link" href="#" aria-label="Next">
            <span class="material-icons"> navigate_next </span>
        </a>
        </li>`}R.innerHTML=a;const r=document.querySelectorAll(".page-link");r.forEach(i=>{(i.textContent.trim()==="chevron_left"||i.textContent.trim()==="navigate_next")&&i.blur()}),r[s].classList.add("active")}R.addEventListener("click",n=>{const a=document.querySelectorAll(".page-link");if(a.forEach(r=>{r.classList.remove("active")}),n.target.textContent.trim()==="chevron_left"){if(s===1){a[s].classList.add("active"),n.preventDefault();return}s>1&&(s--,a[s].classList.add("active"),y(t,s,g))}else if(n.target.textContent.trim()==="navigate_next"){if(s===D){a[s].classList.add("active"),n.preventDefault();return}s<D&&(s++,a[s].classList.add("active"),y(t,s,g))}else s=Number(n.target.textContent.trim()),a[s].classList.add("active"),y(t,s,g)});let Z=document.querySelector("#search"),ee=document.querySelector("#submit");ee.addEventListener("click",function(n){let r=`q=${Z.value}&status=已媒合`;u.get(`${b}rents?${r}`).then(function(i){let o=i.data;o.length>0?(y(r,s,g),f(o)):C()})});u.get("https://gist.githubusercontent.com/abc873693/2804e64324eaaf26515281710e1792df/raw/a1e1fc17d04b47c564bbd9dba0d59a6a325ec7c1/taiwan_districts.json").then(function(n){let a=n.data,i=a.map(function(e){return{name:e.name,districts:e.districts.map(function(S){return S.name})}}).filter(e=>e.name!=="釣魚臺"&&e.name!=="南海島");function o(e,S){const l=["臺北市","新北市","基隆市","桃園市","新竹市","新竹縣","臺中市","彰化縣","苗栗縣","南投縣","雲林縣","高雄市","臺南市","嘉義市","嘉義縣","屏東縣","宜蘭縣","花蓮縣","臺東縣","澎湖縣","金門縣","連江縣"];return l.indexOf(e.name)-l.indexOf(S.name)}i.sort(o);let k=document.querySelectorAll(".countyCity"),v=document.querySelector(".btnTitle"),$=document.querySelector(".dropdownTitle"),_=document.querySelector(".districtList");document.querySelectorAll(".form-check-input"),k.forEach(function(e){e.addEventListener("change",function(S){document.querySelector("#disabled-events").classList.remove("disabled-events");let l=Array.from(k).indexOf(e),d=i[l],N=`${d.name}`,H=`${d.name}`,P="";d.districts.forEach(function(O,A){P+=` 
                                        <li class="pb-2">
                                            <div class="form-check-inline cursor">
                                                <input class="form-check-input cursor districtCheckbox" type="checkbox" id="district${A}" value="${d.name}">
                                                <label class="form-check-label cursor districtLabelText" for="district${A}">${O}</label>
                                            </div>
                                        </li>
                                        `}),v.textContent=N,$.textContent=H,_.innerHTML=P,document.querySelectorAll(".form-check-input")})});let x=document.querySelector("#row"),c="",L="";x.addEventListener("change",function(e){const l=document.querySelector(`label[for='${e.target.id}']`).textContent.trim();e.target.checked?(e.target.type==="radio"&&e.target.classList.contains("cityRadio")?c=`address_like=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("districtCheckbox")?c+=`&district_like=${l}`:e.target.type==="radio"&&e.target.classList.contains("priceRadio")?L=`&${e.target.dataset.price}&_sort=price&_order=desc`:e.target.type==="checkbox"&&e.target.classList.contains("houseCheckbox")?c+=`&type=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("lifeEquipmentCheckbox")?c+=`&lifeEquipment_like=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("equipmentCheckbox")?c+=`&equipment_like=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("identityCheckbox")?c+=`&identity_like=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("genderCheckbox")?c+=`&gender=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("canPetCookCheckbox")&&(l=="可開伙"?c+=`&canCooking=${!0}`:c+=`&canPet=${!0}`),t=c+L+"&status=已媒合",u.get(`${b}rents?${t}`).then(function(d){d.data.length>0?(a=d.data,y(t,1,g),s=1,f(a)):(a=d.data,C(),s=1,f(a))})):(e.target.type==="radio"&&e.target.classList.contains("cityRadio")?c=c.replace(`address_like=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("districtCheckbox")?c=c.replace(`&district_like=${l}`,""):e.target.type==="radio"&&e.target.classList.contains("priceRadio")?L=c.replace(`&${e.target.dataset.price}`,""):e.target.type==="checkbox"&&e.target.classList.contains("houseCheckbox")?c=c.replace(`&type=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("lifeEquipmentCheckbox")?c=c.replace(`&lifeEquipment_like=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("equipmentCheckbox")?c=c.replace(`&equipment_like=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("identityCheckbox")?c=c.replace(`&identity_like=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("genderCheckbox")?c=c.replace(`&gender=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("canPetCookCheckbox")&&(l=="可開伙"?c=c.replace(`&canCooking=${!0}`,""):c=c.replace(`&canPet=${!0}`,"")),t=c+L+"&status=已媒合",u.get(`${b}rents?${t}`).then(function(d){d.data.length>0?(a=d.data,y(t,1,g),s=1,f(a)):(a=d.data,C(),s=1,f(a))}))})});let te=document.querySelector("#close");te.addEventListener("click",function(n){location.reload()});function ae(){document.querySelectorAll(".link-title").forEach(a=>{a.addEventListener("click",function(r){r.preventDefault();const i=new URL(r.target.href),k=new URLSearchParams(i.search).get("id");u.get(`${b}rents/${k}`).then(function(v){const $=v.data;let _={view:parseInt($.view)+1};u.patch(`${b}rents/${k}`,_).then(function(x){window.location.href=r.target.href}).catch(function(x){console.error(x)})}).catch(function(v){console.error(v)})})})}
