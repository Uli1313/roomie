import{a as u,S as U}from"./bootstrap.min-acd3fe77.js";const j="https://roomie-lfta.onrender.com",z=localStorage.getItem("userId"),F=localStorage.getItem("token"),V={headers:{Authorization:`Bearer ${F}`}};let B;const I=document.querySelectorAll(".nav-logged"),M=document.querySelectorAll(".nav-unlogged"),J=document.querySelectorAll(".nav-logged-photo"),W=document.querySelector(".logout-btn");(async()=>{try{const c=`/600/users/${z}`,a=`${j}${c}`,r=await u.get(a,V),i=r.data.photo;J.forEach(o=>o.setAttribute("src",i)),B=r.data,Y(),I.forEach(o=>{o.classList.remove("d-none")}),M.forEach(o=>{o.classList.add("d-none")})}catch(c){console.log(c),I.forEach(a=>{a.classList.add("d-none")}),M.forEach(a=>{a.classList.remove("d-none")})}})();function Y(){localStorage.setItem("user",JSON.stringify(B))}W.addEventListener("click",G);function G(){U.fire({icon:"question",title:"確定要登出嗎",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(c=>{c.isConfirmed&&(localStorage.removeItem("userId"),localStorage.removeItem("token"),localStorage.removeItem("user"),U.fire({icon:"success",title:"已登出",timer:1500,showConfirmButton:!1}),setTimeout(()=>{location.href="login.html"},1e3))})}const b="https://roomie-lfta.onrender.com/";let t="",f=[];function K(c){let a=document.querySelector("#list"),r="";c.forEach(function(i){const o=`${i.updateDate}`,k=new Date(o),v=`${i.soldDate}`,$=new Date(v),S=new Date,x=k.getTime()-$.getTime(),n=$.getTime()-S.getTime(),L=Math.abs(Math.trunc(x/(1e3*3600*24))),e=Math.abs(Math.trunc(n/(1e3*3600*24)));r+=`<div class="col-12 my-3 p-1 hover-primary-2 rounded">
                    <div class="col-12 p-3 bg-white d-flex flex-wrap justify-content-evenly align-items-center text-end text-lg-center border rounded">
                        <div class="col-12 col-lg-4"><a href="matchArticle.html?id=${i.id}" class="link-dark fw-bold">${i.title}</a></div>
                        <div class="col-12 col-lg pb-1 pb-lg-0"><span class="text-primary">${e}日前&nbsp;</span>媒合成功</div>
                        <div class="col-12 col-lg pb-1 pb-lg-0">${i["square Footage"]}坪&nbsp;/&nbsp;${i.type}</div>
                        <div class="col-12 col-lg fw-bold text-primary">${i.price.toLocaleString("zh-TW")}元/月</div>
                        <div class="col-12 col-lg">
                            <span class="text-primary">花費${L}日&nbsp;</span>
                            媒合成功
                            <span class="material-symbols-outlined ps-1 text-danger" style="transform: translateY(24%);">verified</span>
                        </div>
                    </div>
                </div>
                `}),a.innerHTML=r,ie()}function C(){let c=document.querySelector("#list"),a=`
                <div class="row rounded">
                    <div class="col bg-white rounded m-5 p-5 d-flex flex-column justify-content-center align-items-center ">
                        <p>¯_(ツ)_/¯</p>
                        <p class="p-2 h5">對不起，沒有找到適合您的物件！</p>
                        <p>建議您：重新篩選或搜尋試試看唷～</p>
                    </div>
                </div>`;c.innerHTML=a}function Q(){t="_sort=view&_order=desc&status=已媒合",u.get(`${b}rents?${t}`).then(function(c){f=c.data,y(t,s,g),p(f)})}Q();let X=document.querySelector("#filterDate"),Z=document.querySelector("#filterPrice"),m="&_sort=soldDate&_order=asc",_="&_sort=soldDate&_order=desc",h="&_sort=price&_order=asc",w="&_sort=price&_order=desc",E="_sort=view&_order=desc";function ee(){X.addEventListener("click",function(c){t.includes(m)?t=t.replace(m,_):t.includes(_)?t=t.replace(_,m):t.includes(h)?t=t.replace(h,m):t.includes(w)?t=t.replace(w,m):t.includes(E)?t=t.replace(E,m):t+=m,u.get(`${b}rents?${t}`).then(function(a){f=a.data,f.length>0?(y(t,1,g),s=1,p(f)):(C(),s=1,p(f))})})}ee();function te(){Z.addEventListener("click",function(c){t.includes(h)?t=t.replace(h,w):t.includes(w)?t=t.replace(w,h):t.includes(m)?t=t.replace(m,h):t.includes(_)?t=t.replace(_,h):t.includes(E)?t=t.replace(E,h):t+=h,u.get(`${b}rents?${t}`).then(function(a){f=a.data,f.length>0?(y(t,1,g),s=1,p(f)):(C(),s=1,p(f))})})}te();let D,T,g=4,s=1,R=document.querySelector(".pagination");function y(c,a,r){u.get(`${b}rents?${c}&_page=${a}&_limit=${r}`).then(i=>{let o=i.data;K(o)})}function p(c){D=c.length,T=Math.ceil(D/g);let a="";if(D==0)a="";else{a+=`<li class="page-item">
        <a class="page-link" href="#" aria-label="Previous">
            <span class="material-icons align-bottom">
            chevron_left
            </span>
        </a>
        </li>`;for(let i=1;i<=T;i++)a+=`<li class="page-item">
            <a class="page-link" href="#">${i}</a>
        </li>`;a+=`<li class="page-item">
        <a class="page-link" href="#" aria-label="Next">
            <span class="material-icons"> navigate_next </span>
        </a>
        </li>`}R.innerHTML=a;const r=document.querySelectorAll(".page-link");r.forEach(i=>{(i.textContent.trim()==="chevron_left"||i.textContent.trim()==="navigate_next")&&i.blur()}),r[s].classList.add("active")}R.addEventListener("click",c=>{const a=document.querySelectorAll(".page-link");if(a.forEach(r=>{r.classList.remove("active")}),c.target.textContent.trim()==="chevron_left"){if(s===1){a[s].classList.add("active"),c.preventDefault();return}s>1&&(s--,a[s].classList.add("active"),y(t,s,g))}else if(c.target.textContent.trim()==="navigate_next"){if(s===T){a[s].classList.add("active"),c.preventDefault();return}s<T&&(s++,a[s].classList.add("active"),y(t,s,g))}else s=Number(c.target.textContent.trim()),a[s].classList.add("active"),y(t,s,g)});let ae=document.querySelector("#search"),ne=document.querySelector("#submit");ne.addEventListener("click",function(c){let r=`q=${ae.value}&status=已媒合`;u.get(`${b}rents?${r}`).then(function(i){let o=i.data;o.length>0?(y(r,s,g),p(o)):C()})});u.get("https://gist.githubusercontent.com/abc873693/2804e64324eaaf26515281710e1792df/raw/a1e1fc17d04b47c564bbd9dba0d59a6a325ec7c1/taiwan_districts.json").then(function(c){let a=c.data,i=a.map(function(e){return{name:e.name,districts:e.districts.map(function(q){return q.name})}}).filter(e=>e.name!=="釣魚臺"&&e.name!=="南海島");function o(e,q){const l=["臺北市","新北市","基隆市","桃園市","新竹市","新竹縣","臺中市","彰化縣","苗栗縣","南投縣","雲林縣","高雄市","臺南市","嘉義市","嘉義縣","屏東縣","宜蘭縣","花蓮縣","臺東縣","澎湖縣","金門縣","連江縣"];return l.indexOf(e.name)-l.indexOf(q.name)}i.sort(o);let k=document.querySelectorAll(".countyCity"),v=document.querySelector(".btnTitle"),$=document.querySelector(".dropdownTitle"),S=document.querySelector(".districtList");document.querySelectorAll(".form-check-input"),k.forEach(function(e){e.addEventListener("change",function(q){document.querySelector("#disabled-events").classList.remove("disabled-events");let l=Array.from(k).indexOf(e),d=i[l],N=`${d.name}`,H=`${d.name}`,P="";d.districts.forEach(function(O,A){P+=` 
                                        <li class="pb-2">
                                            <div class="form-check-inline cursor">
                                                <input class="form-check-input cursor districtCheckbox" type="checkbox" id="district${A}" value="${d.name}">
                                                <label class="form-check-label cursor districtLabelText" for="district${A}">${O}</label>
                                            </div>
                                        </li>
                                        `}),v.textContent=N,$.textContent=H,S.innerHTML=P,document.querySelectorAll(".form-check-input")})});let x=document.querySelector("#row"),n="",L="";x.addEventListener("change",function(e){const l=document.querySelector(`label[for='${e.target.id}']`).textContent.trim();e.target.checked?(e.target.type==="radio"&&e.target.classList.contains("cityRadio")?n=`address_like=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("districtCheckbox")?n+=`&district_like=${l}`:e.target.type==="radio"&&e.target.classList.contains("priceRadio")?L=`&${e.target.dataset.price}&_sort=price&_order=desc`:e.target.type==="checkbox"&&e.target.classList.contains("houseCheckbox")?n+=`&type=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("lifeEquipmentCheckbox")?n+=`&lifeEquipment_like=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("equipmentCheckbox")?n+=`&equipment_like=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("identityCheckbox")?n+=`&identity_like=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("genderCheckbox")?n+=`&gender=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("canPetCookCheckbox")&&(l=="可開伙"?n+=`&canCooking=${!0}`:n+=`&canPet=${!0}`),t=n+L+"&status=已媒合",u.get(`${b}rents?${t}`).then(function(d){d.data.length>0?(a=d.data,y(t,1,g),s=1,p(a)):(a=d.data,C(),s=1,p(a))})):(e.target.type==="radio"&&e.target.classList.contains("cityRadio")?n=n.replace(`address_like=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("districtCheckbox")?n=n.replace(`&district_like=${l}`,""):e.target.type==="radio"&&e.target.classList.contains("priceRadio")?L=n.replace(`&${e.target.dataset.price}`,""):e.target.type==="checkbox"&&e.target.classList.contains("houseCheckbox")?n=n.replace(`&type=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("lifeEquipmentCheckbox")?n=n.replace(`&lifeEquipment_like=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("equipmentCheckbox")?n=n.replace(`&equipment_like=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("identityCheckbox")?n=n.replace(`&identity_like=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("genderCheckbox")?n=n.replace(`&gender=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("canPetCookCheckbox")&&(l=="可開伙"?n=n.replace(`&canCooking=${!0}`,""):n=n.replace(`&canPet=${!0}`,"")),t=n+L+"&status=已媒合",u.get(`${b}rents?${t}`).then(function(d){d.data.length>0?(a=d.data,y(t,1,g),s=1,p(a)):(a=d.data,C(),s=1,p(a))}))})});let ce=document.querySelector("#close");ce.addEventListener("click",function(c){location.reload()});function ie(){document.querySelectorAll(".link-title").forEach(a=>{a.addEventListener("click",function(r){r.preventDefault();const i=new URL(r.target.href),k=new URLSearchParams(i.search).get("id");u.get(`${b}rents/${k}`).then(function(v){const $=v.data;let S={view:parseInt($.view)+1};u.patch(`${b}rents/${k}`,S).then(function(x){window.location.href=r.target.href}).catch(function(x){console.error(x)})}).catch(function(v){console.error(v)})})})}
