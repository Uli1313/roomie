import"./bootstrap.min-340b141d.js";import{a as p}from"./axios-28bc18a3.js";const y="https://roomie-lfta.onrender.com",C=document.querySelector(".confirmEmail"),s=document.querySelector("#inputEmail"),b=document.querySelector("#inputSecurityCode"),r=document.querySelector("#securityCodeBtn"),a=document.querySelector("#inputPassword"),i=document.querySelector("#inputConfirmPassword"),h=document.querySelector("#resetPasswordBtn");let E,d,c=[];async function m(e,t){const n=t.trim();return n===""?(u(e,"請勿空白!"),!1):e===s&&await v(n)?(u(e,"這個帳號尚未註冊過"),!1):(e===a||e===i)&&k(e,n)?(u(e,"請填寫正確密碼!"),!1):(e.parentElement.children[2].style.display="none",!0)}function u(e,t){e.parentElement.children[2].style.display="flex",e.parentElement.children[2].children[0].children[0].textContent=`${t}`}async function v(e){try{const n=(await p.get(y+"/users")).data;let o=!1;const l=n.filter(w=>w.email===e);return l.length===1?E=l[0].id:o=!0,o}catch(t){console.error("Error fetching user information:",t)}}function P(e){d=x(5);let t=`使用者:Email:${e}<br/>驗證碼:${d}<br/>Messages:roomie會員忘記密碼，需要重新設定<br/> `;Email.send({SecureToken:"64af44cb-e8aa-46d2-9138-00053a70aca2",To:e,From:"roomie0921@gmail.com",Subject:"親愛的會員您好，Roomie客服中心寄送驗證碼來囉~",Body:t}).then(n=>alert("已傳送驗證碼到信箱")).catch(n=>{console.log(n.response)})}function x(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let o=0;o<e;o++){const l=Math.floor(Math.random()*t.length);n+=t.charAt(l)}return n}function f(e){r.parentElement.previousElementSibling.style.display="flex",e||(r.parentElement.previousElementSibling.textContent="驗證失敗",r.parentElement.previousElementSibling.style.color="red")}function g(e){e.parentElement.parentElement.style.display="none"}function k(e,t){let n=!1;return/^(?!.*\d{6,})(?!.*(.)\1{4,}).{6,12}$/.test(t)||(n=!0),e===i&&t!==c[0]?n=!0:e===a&&n===!1?c.push(t):c=[],n}function q(e){p.patch(y+`/users/${E}`,{password:`${e}`}).then(t=>{console.log(t.data),B()}).catch(t=>{console.log(t.response)})}function B(){setTimeout(()=>{window.location.href="https://uli1313.github.io/roomie/login.html"},1e3)}C.addEventListener("click",async e=>{await m(s,s.value)&&(P(s.value.trim()),r.parentElement.parentElement.style.display="flex",g(s))});r.addEventListener("click",e=>{b.value===d?(f(!0),g(r),h.parentElement.parentElement.style.display="block"):f(!1)});h.addEventListener("click",async e=>{const t=a.value,n=i.value;await m(a,t)&&await m(i,n)&&q(t)});
