import"./bootstrap.min-e773685c.js";import{a as d}from"./axios-28bc18a3.js";import{S as k}from"./sweetalert2.all-b34669d1.js";const m="http://localhost:3000",f=localStorage.getItem("userId"),b=localStorage.getItem("token"),g={headers:{Authorization:`Bearer ${b}`}},c=document.querySelector("#nickName"),s=document.querySelector("#name"),r=document.querySelector("#genderMale"),l=document.querySelector("#genderFemal");function q(){I()}q();let o;async function I(){try{const e=`/600/users/${f}`,a=`${m}${e}`;o=(await d.get(a,g)).data,v(),S()}catch(e){console.log(e)}}function v(){localStorage.setItem("user",JSON.stringify(o))}function P(){const e=localStorage.getItem("user");e&&(o=JSON.parse(e),S())}P();function S(){c&&s&&r&&l&&(c.value=o.nickname,s.value=o.name,document.getElementById("userNickName").textContent=o.nickname,document.getElementById("userEmail").textContent=o.email,document.getElementById("signupEmail").value=o.email,o.gender==="male"?r.checked=!0:l.checked=!0)}const u=document.querySelector(".infoEdit-btn"),i=document.querySelector(".infoSave-btn"),p=document.querySelectorAll(".editable-input"),y=document.querySelector("#aboutMe"),h=(e,a,t)=>{e.forEach(n=>{n[a?"setAttribute":"removeAttribute"]("readonly",a),n.value=n.value.trim()}),r.disabled=t,l.disabled=t,y.readOnly=a},E=async(e,a=!1)=>{try{const t=await d.patch(`${m}/users/${f}`,e);return!a&&k.fire({scrollbarPadding:!1,icon:"success",title:"修改成功",showCancelButton:!1,timer:1500}),t.data}catch(t){throw console.error(t),t}};u.addEventListener("click",e=>{e.preventDefault(),h(p,!1,!1),u.classList.add("d-none"),i.classList.remove("d-none")});i.addEventListener("click",async e=>{e.preventDefault(),h(p,!0,!0);const a={nickname:c.value.trim(),name:s.value.trim(),gender:r.checked?"male":"female",about:y.value.trim()},t=await E(a);o={...o,...t},v(),u.classList.remove("d-none"),i.classList.add("d-none")});const w=document.querySelector("#changePwdForm");function L(e){d.patch(`${m}/600/users/${f}`,{password:e},g).then(a=>{w.reset(),alert("成功")}).catch(a=>{console.log(a.response.data)})}w.addEventListener("submit",e=>{e.preventDefault();const a=document.querySelector("#nowPwd"),t=document.querySelector("#setNewPwd"),n=document.querySelector("#rePwd");a.value.trim()===""||t.value.trim()===""||n.value.trim()===""?alert("欄位不得為空"):t.value.trim()!==n.value.trim()?alert("密碼不一致"):t.value.trim()===n.value.trim()&&L(t.value)});
