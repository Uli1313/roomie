import{a as d,S as h}from"./bootstrap.min-acd3fe77.js";const ue="https://roomie-lfta.onrender.com",le=localStorage.getItem("userId"),se=localStorage.getItem("token"),ie={headers:{Authorization:`Bearer ${se}`}};let L;const $=document.querySelectorAll(".nav-logged"),E=document.querySelectorAll(".nav-unlogged"),fe=document.querySelectorAll(".nav-logged-photo"),me=document.querySelector(".logout-btn");(async()=>{try{const e=`/600/users/${le}`,t=`${ue}${e}`,o=await d.get(t,ie),r=o.data.photo;fe.forEach(a=>a.setAttribute("src",r)),L=o.data,de(),$.forEach(a=>{a.classList.remove("d-none")}),E.forEach(a=>{a.classList.add("d-none")})}catch(e){console.log(e),$.forEach(t=>{t.classList.add("d-none")}),E.forEach(t=>{t.classList.remove("d-none")})}})();function de(){localStorage.setItem("user",JSON.stringify(L))}me.addEventListener("click",pe);function pe(){h.fire({icon:"question",title:"確定要登出嗎",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(e=>{e.isConfirmed&&(localStorage.removeItem("userId"),localStorage.removeItem("token"),localStorage.removeItem("user"),h.fire({icon:"success",title:"已登出",timer:1500,showConfirmButton:!1}),setTimeout(()=>{location.href="login.html"},1e3))})}const N="https://roomie-lfta.onrender.com",w=localStorage.getItem("userId"),F={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},f=document.querySelector("#cityRegion"),p=document.querySelector("#districtRegion"),k=document.querySelector("#pathRegion"),T=document.querySelector("#laneRegion"),P=document.querySelector("#alleyRegion"),C=document.querySelector("#numberRegion"),U=document.querySelector("#floors"),B=document.querySelector("#totalFloors"),he=document.querySelectorAll(".housingType"),D=document.querySelector("#articleTitle"),R=document.querySelector("#sizeofHouse"),H=document.querySelector("#layoutOfHouse"),ge=document.querySelectorAll(".equipmentItem"),z=document.querySelector("#rent"),Q=document.querySelector("#deposit"),Se=document.querySelectorAll(".billItem"),ye=document.querySelector("#managementBill"),m=document.querySelector("#manageFee"),M=document.querySelector("#minPeriod"),O=document.querySelector("#needPeople"),ve=document.querySelectorAll(".roommateItem"),qe=document.querySelectorAll(".sexStatus"),Ae=document.querySelectorAll(".petsStatus"),Ie=document.querySelectorAll(".cookStatus"),W=document.querySelector("#minAge"),_=document.querySelector("#maxAge"),be=document.querySelector("#datepicker"),xe=document.querySelectorAll(".lifeFunction"),$e=document.querySelector("#busStation"),Ee=document.querySelector("#mrtStation"),ke=document.querySelector("#trainStation"),Te=document.querySelector("#hightSpeedStation"),l=document.querySelector("#somethingElse"),Pe=document.querySelector("#wordLength"),Ce=document.querySelector(".fileUploaderOne"),Ve=document.querySelector(".fileUploaderTwo"),Le=document.querySelector(".fileUploaderThree"),Ne=document.querySelector(".fileUploaderFour"),we=document.querySelector(".fileUploaderFive"),Fe=document.querySelector("#contactName"),Ue=document.querySelectorAll(".contactSexStatus"),Be=document.querySelector("#contactPhoneNumber"),De=document.querySelector("#contactEmail"),Re=document.querySelector("#contactLine"),V=document.querySelectorAll(".contactForSuccess"),He=document.querySelector(".draftBtn"),ze=document.querySelector(".publishBtn"),Qe=document.querySelectorAll(".post-alert-message");let b,g=[],X="",i=[],s=[],S=[],j="",y=!1,v=!1,J="",q=[],A=[],K="",Y=[],c={},I=!1,x="";d.get("https://gist.githubusercontent.com/abc873693/2804e64324eaaf26515281710e1792df/raw/a1e1fc17d04b47c564bbd9dba0d59a6a325ec7c1/taiwan_districts.json").then(function(e){b=e.data.map(function(r){return{name:r.name,districts:r.districts.map(function(a){return a.name})}}).filter(r=>r.name!=="釣魚臺"&&r.name!=="南海島"),Me()});function Me(){let e="<option>縣市</option>";b.forEach(t=>{e+=`<option  value="${t.name}">${t.name}</option>`}),f.innerHTML=e}f.addEventListener("change",e=>{Oe(e.target.value)});function Oe(e){let t="<option>行政區</option>";b.forEach(o=>{o.name===e&&o.districts.forEach(r=>{t+=`<option  value="${r}">${r}</option>`})}),p.innerHTML=t}function n(e,t){const o=Array.from(Qe)[e];let r=o.children[0];if(t===""){o.style.display="none";return}o.style.display="flex",r.textContent=t}function We(){if(f.value===""||f.value==="縣市"||p.value===""||p.value==="行政區"||k.value.trim()===""||T.value.trim()==="")return n(0,"縣市、行政區、路段/街、巷皆須完整填寫!"),!1;n(0),g.push(p.value);let e=`${k.value}${T.value}`;return P.value!==""&&(e+=`${P.value}`),C.value!==""&&(e+=`${C.value}`),g.push(e),!0}function _e(){return U.value.trim()===""?(n(1,"樓層須填寫!"),!1):B.value.trim()===""?(n(1,"總樓層須填寫!"),!1):(n(1),!0)}function Xe(){const e=Array.from(he);let t=!1;return e.forEach(o=>{o.checked&&(X=o.nextElementSibling.textContent,t=!0)}),t?n(2):n(2,"請點選房屋類型!"),t}function je(){return D.value.trim()===""?(n(3,"QAQ標題呢"),!1):(n(3),!0)}function Je(){return R.value.trim()===""?(n(4,"坪數需填寫唷!"),!1):(n(4),!0)}function Ke(){return H.value.trim()===""?(n(5,"格局需填寫唷!"),!1):(n(5),!0)}function Ye(){const e=Array.from(ge);let t=!0;return e[e.length-1].checked===!0?(n(6),i.push("無"),t):(i=[],e.forEach(o=>{o.checked&&i.push(o.nextElementSibling.textContent)}),i.length===0?(n(6,"請勾選一下~(沒有則是勾無)"),t=!1):n(6),t)}function Ge(){return z.value.trim()===""?(n(7,"是上天派來的天使嗎!"),!1):Q.value==="押金"?(n(7,"要選一或兩個月唷~"),!1):(n(7),!0)}function Ze(){const e=Array.from(Se);let t=!0;return e[e.length-1].checked===!0?(n(8),s.push("無"),t):(s=[],e.forEach(o=>{o.checked&&s.push(o.nextElementSibling.textContent)}),s.length===0?(n(8,"請勾選一下~(沒有則是勾無)"),t=!1):n(8),t)}function et(){return s.some(t=>t==="管理費")?m.value.trim()===""?(n(9,"不填寫管委會會把你抓走!"),!1):isNaN(Number(m.value))?(n(9,"請填寫數字~"),!1):(n(9),!0):(n(9),!0)}function tt(){return M.value==="時間"?(n(10,"請填寫時間!"),!1):(n(10),!0)}function nt(){return O.value.trim()===""?(n(11,"都來找合租了沒有人數合理嗎QAQ"),!1):(n(11),!0)}function ot(){const e=Array.from(ve);return S=[],e.forEach(t=>{t.checked&&S.push(t.nextElementSibling.textContent)}),!0}function rt(){return Array.from(qe).forEach(t=>{t.checked&&(j=t.nextElementSibling.textContent)}),!0}function at(){const e=Array.from(Ae);return e.some(t=>t.checked)?(n(12),e[0].checked?y=!0:y=!1,!0):(n(12,"請點選可以/不行~"),!1)}function ct(){const e=Array.from(Ie);return e.some(t=>t.checked)?(n(13),e[0].checked?v=!0:v=!1,!0):(n(13,"請點選可以/不行~"),!1)}function ut(){const e=Number(W.value),t=Number(_.value);return isNaN(e)||isNaN(t)?(n(14,"請填寫數字~"),!1):e>t?(n(14,"從低到高填~"),!1):e<18||t>100?(n(14,"填18~100歲"),!1):(n(14),!0)}function lt(){const e=be.value.split("/");return e.length===1?(n(15,"總是要讓人知道日期吧!(握拳"),!1):(n(15),J=`${e[2]}/${e[1]}/${e[0]}`,!0)}function st(){const e=Array.from(xe);return q=[],e.forEach(t=>{t.checked&&q.push(t.nextElementSibling.textContent)}),!0}function it(){return A=[],[$e,Ee,ke,Te].forEach(t=>{t.value.trim()!==""&&A.push(`${t.value}${t.nextElementSibling.textContent}`)}),!0}function ft(){return K=l.value.trim(),!0}async function mt(){let e=[Ce,Ve,Le,Ne,we];return e.some(t=>t.files[0]===void 0)?(n(17,"不想讓大家看房間增加租客嗎!想嘛，所以請把五張照片發好發滿唷"),!1):(await Promise.all(e.map(async t=>{t.files[0]!==void 0&&t.files[0].type.startsWith("image/")&&await dt(t)})),n(17),!0)}function dt(e){return new Promise((t,o)=>{const r=e.files[0];let a=new FileReader;const u={};a.onload=ne=>{const oe=r.name,re=r.type,ae=ne.target.result.split(",")[1];u.fileName=oe,u.fileType=re,u.base64Data=ae,pt(u).then(()=>t()).catch(ce=>o(ce))},a.readAsDataURL(r)})}function pt(e){return new Promise((t,o)=>{d.post("https://script.google.com/macros/s/AKfycbySmWyqFenx525ANUQtipn-TwPUDdThAWhaXkcCrfyS5nAeAqdo_I3kprq6H5zUTXzI/exec",e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(r){console.log();const a=r.data.split("file/d/")[1].split("/view?")[0];Y.push(`https://drive.google.com/uc?export=view&id=${a}`),t()}).catch(function(r){console.log(r),o(r)})})}function ht(){const e=Fe.value.trim(),t=Array.from(Ue);let o=[];return e===""||!t.some(r=>r.checked)?(n(18,"這樣如何叫你啦?"),!1):e.split("").length>2?(n(18,"填姓氏不是名字!"),!1):(n(18),o.push(e),t.forEach(r=>{r.checked&&o.push(r.nextElementSibling.textContent)}),c.person=o,!0)}function gt(){const e=Be.value.trim();return e===""?(n(19,"請留下電話QAQ(跪"),!1):(n(19),c.phone=e,!0)}function St(){const e=De.value.trim();return e===""?(n(20,"發送前請留下信箱吧!"),!1):(n(20),c.email=e,!0)}function yt(){const e=Re.value.trim();return c.line=e,!0}function vt(){if(!Array.from(V).some(e=>e.checked)){n(21,"不同意沒關係 真的沒關係，但還是要點唷");return}return Array.from(V).forEach(e=>{e.checked&&(e.nextElementSibling.textContent==="同意"?I=!0:I=!1)}),n(21),!0}ze.addEventListener("click",async e=>{await G()===!0&&(x="刊登中",Z(),ee(),te("文章"))});He.addEventListener("click",async e=>{await G()===!0&&(x="草稿",Z(),ee(),te("草稿"))});async function G(){let e=[];if(e.push(We()),e.push(_e()),e.push(Xe()),e.push(je()),e.push(Je()),e.push(Ke()),e.push(Ye()),e.push(Ge()),e.push(Ze()),e.push(et()),e.push(tt()),e.push(nt()),e.push(ot()),e.push(rt()),e.push(at()),e.push(ct()),e.push(ut()),e.push(lt()),e.push(st()),e.push(it()),e.push(ft()),e.push(await mt()),e.push(ht()),e.push(gt()),e.push(St()),e.push(yt()),e.push(vt()),e.every(t=>t===!0))return!0}ye.addEventListener("click",e=>{if(!e.target.checked){m.setAttribute("disabled","disabled");return}m.removeAttribute("disabled")});l.addEventListener("input",e=>{let t=l.value.split("").length;const o=500;if(t>o){l.value=l.value.substring(0,o),n(16,"字數已達標，斟酌一下啦(拜託");return}else n(16),Pe.textContent=l.value.split("").length});function qt(){const e=new Date,t=e.getFullYear(),o=e.getMonth()+1,r=e.getDate(),a=e.getHours(),u=e.getMinutes();return`${t}/${o}/${r} ${a}:${u}`}function Z(){const e={userId:Number(w),status:`${x}`,updateDate:`${qt()}`,soldDate:"",view:0,address:`${f.value}`,district:g,floor:Number(U.value.trim()),totalFloor:Number(B.value.trim()),type:`${X}`,title:`${D.value.trim()}`,"square Footage":Number(R.value.trim()),houseLayout:`${H.value.trim()}`,equipment:i,price:Number(z.value.trim()),deposit:`${Q.value}`,priceInclude:s,manageFee:Number(m.value.trim()),minPeriod:`${M.value}`,needPartner:Number(O.value.trim()),identity:S,gender:`${j}`,canPet:y,canCooking:v,minAge:Number(W.value.trim()),maxAge:Number(_.value.trim()),moveInDate:`${J}`,lifeEquipment:q,traffic:A,intro:`${K}`,photo:Y,agreePublish:I};d.post(`${N}/600/rents`,e,F).then(t=>{console.log(t.data)}).catch(t=>{console.log(t.response)})}function ee(){let e={person:[`${c.person[0]}`,`${c.person[1]}`],phone:`${c.phone}`,email:`${c.email}`,line:`${c.line}`};d.patch(`${N}/600/users/${w}`,{contact:e},F).then(t=>{console.log(t.data)}).catch(t=>{console.log(t.response)})}function te(e){h.fire({icon:"question",title:`確定發表${e}嗎`,text:"一旦發表後...沒 沒有然後了",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(t=>{t.isConfirmed&&(h.fire({icon:"success",title:"新增貼文成功",timer:1500,showConfirmButton:!1}),setTimeout(()=>{location.href="user_posts.html"},2e3))})}
