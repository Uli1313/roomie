import{a as r}from"./bootstrap.min-f14bc68a.js";import{S as b}from"./sweetalert2.all-9c23d2ec.js";const T="https://roomie-lfta.onrender.com",z=localStorage.getItem("userId"),M=localStorage.getItem("token"),R={headers:{Authorization:`Bearer ${M}`}};let E;const q=document.querySelectorAll(".nav-logged"),L=document.querySelectorAll(".nav-unlogged"),J=document.querySelectorAll(".nav-logged-photo");(async()=>{try{const e=`/600/users/${z}`,t=`${T}${e}`,o=await r.get(t,R),s=o.data.photo;J.forEach(n=>n.setAttribute("src",s)),E=o.data,V(),q.forEach(n=>{n.classList.remove("d-none")}),L.forEach(n=>{n.classList.add("d-none")}),console.log("已登入")}catch(e){console.log(e),q.forEach(t=>{t.classList.add("d-none")}),L.forEach(t=>{t.classList.remove("d-none")}),console.log("未登入")}})();function V(){localStorage.setItem("user",JSON.stringify(E))}const c="https://roomie-lfta.onrender.com",l=localStorage.getItem("userId"),_=localStorage.getItem("token"),P={headers:{Authorization:`Bearer ${_}`}},p=document.querySelector("#nickName"),S=document.querySelector("#name"),h=document.querySelector("#genderMale"),y=document.querySelector("#genderFemal");function j(){O(),A()}j();let a;async function O(){try{const e=`/600/users/${l}`,t=`${c}${e}`;a=(await r.get(t,P)).data,U(),F()}catch(e){console.log(e),(e.response.status===401||e.response.statusText==="Unauthorized")&&["user.html","user_posts.html","user_favorites.html","user_messages.html"].some(o=>location.pathname.match(o))&&b.fire({icon:"warning",title:"請重新登入",scrollbarPadding:!1,didClose:()=>{C(),location.href="login.html"}})}}function U(){localStorage.setItem("user",JSON.stringify(a))}function W(){const e=localStorage.getItem("user");e&&(a=JSON.parse(e),F())}W();function F(){p&&S&&h&&y&&(p.value=a.nickname,S.value=a.name,document.getElementById("userNickName").textContent=a.nickname,document.getElementById("userEmail").textContent=a.email,document.getElementById("signupEmail").value=a.email,document.getElementById("userPhoto").src=a.photo,a.gender==="male"?h.checked=!0:y.checked=!0)}const w=document.querySelector(".infoEdit-btn"),I=document.querySelector(".infoSave-btn"),N=document.querySelectorAll(".editable-input"),x=document.querySelector("#aboutMe"),G=document.querySelector("#updateFile"),B=document.querySelector(".selectFile"),f={},D=(e,t,o)=>{e.forEach(s=>{s[t?"setAttribute":"removeAttribute"]("readonly",t),s.value=s.value.trim()}),h.disabled=o,y.disabled=o,x.readOnly=t},H=async(e,t=!1)=>{try{const o=await r.patch(`${c}/users/${l}`,e);return!t&&b.fire({scrollbarPadding:!1,icon:"success",title:"修改成功",showCancelButton:!1,timer:1500}),console.log(o.data),o.data}catch(o){throw console.error(o),o}};w.addEventListener("click",e=>{e.preventDefault(),D(N,!1,!1),w.classList.add("d-none"),I.classList.remove("d-none"),B.classList.remove("d-none")});I.addEventListener("click",async e=>{e.preventDefault(),D(N,!0,!0);const t={nickname:p.value.trim(),name:S.value.trim(),gender:h.checked?"male":"female",about:x.value.trim(),photo:f.base64Image},o=await H(t);a={...a,...o},U(),w.classList.remove("d-none"),I.classList.add("d-none"),B.classList.add("d-none")});G.addEventListener("change",e=>{const t=e.target.files[0],o=new FileReader;o.onload=s=>{const n=s.target.result;f.base64Image=n,f.fileName=t.name;let d=document.getElementById("userPhoto");d.src=f.base64Image},o.readAsDataURL(t)});let u=[],m=[],g=[];function A(){r.get(`${c}/rents?userId=${l}`).then(e=>{u=e.data,v(u,m,g)}).catch(e=>{console.log(e)}),r.get(`${c}/favorites?userId=${l}`).then(e=>{m=e.data,v(u,m,g)}).catch(e=>{console.log(e)}),r.get(`${c}/qas?userId=${l}`).then(e=>{g=e.data,v(u,m,g)}).catch(e=>{console.log(e)})}A();const K=document.querySelector(".postsNum"),Q=document.querySelector(".favsNum"),X=document.querySelector(".commentsNum");function v(e,t,o){K.textContent=e.length,Q.textContent=t.length,X.textContent=o.length}const k=document.querySelector("#changePwdForm");k.addEventListener("submit",e=>{e.preventDefault(),Z()});function Y(e){r.patch(`${c}/600/users/${l}`,{password:e},P).then(t=>{k.reset(),b.fire({icon:"success",title:"變更密碼成功",showConfirmButton:!1,timer:1500,didClose:()=>{C(),location.href="login.html"}}),k.classList.remove("was-validated")}).catch(t=>{console.log(t)})}function Z(){const e=document.querySelector("#nowPwd"),t=document.querySelector("#setNewPwd"),o=document.querySelector("#rePwd"),s=e.value.trim(),n=t.value.trim(),d=o.value.trim();if(s===""?i(e,"欄位不得為空"):$(e),n===""?i(t,"欄位不得為空"):ee(n)||te(n)?i(t,"密碼不安全"):$(t),d==="")i(o,"欄位不得為空");else if(n!==d)i(o,"密碼不一致");else if(n===d){Y(n);return}}function i(e,t){const o=e.parentElement,s=o.querySelector(".invalid-feedback");s.innerText=t,o.classList.add("was-validated")}function $(e){e.parentElement.classList.add("was-validated")}function ee(e){return/123456|234567|345678|456789|567890|abcdefghijklmnopqrstuvwxyz|zyxwvutsrqponmlkjihgfedcba/i.test(e)}function te(e){return e.length<6}function C(){localStorage.removeItem("token"),localStorage.removeItem("userId")}
