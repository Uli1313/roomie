import"./bootstrap.min-e773685c.js";import{a as m}from"./axios-28bc18a3.js";const f="https://roomie-lfta.onrender.com",w=document.querySelector(".confirmEmail"),o=document.querySelector("#inputEmail");document.querySelector("#inputSecurityCode");const h=document.querySelector("#securityCodeBtn"),a=document.querySelector("#inputPassword"),c=document.querySelector("#inputConfirmPassword"),E=document.querySelector("#resetPasswordBtn");let y,u,l=[];async function d(e,t){const n=t.trim();return n===""?(i(e,"請勿空白!"),!1):e===o&&await g(n)?(i(e,"這個帳號尚未註冊過"),!1):(e===a||e===c)&&b(e,n)?(i(e,"請填寫正確密碼!"),!1):(e.parentElement.children[2].style.display="none",!0)}function i(e,t){e.parentElement.children[2].style.display="flex",e.parentElement.children[2].children[0].children[0].textContent=`${t}`}async function g(e){try{const n=(await m.get(f+"/users")).data;let r=!1;const s=n.filter(p=>p.email===e);return s.length===1?y=s[0].id:r=!0,r}catch(t){console.error("Error fetching user information:",t)}}function C(e){u=P(5);let t=`使用者:Email:${e}<br/>驗證碼:${u}<br/>Messages:roomie會員忘記密碼，需要重新設定<br/> `;Email.send({SecureToken:"64af44cb-e8aa-46d2-9138-00053a70aca2",To:e,From:"roomie0921@gmail.com",Subject:"親愛的會員您好，Roomie客服中心寄送驗證碼來囉~",Body:t}).then(n=>alert("已傳送驗證碼到信箱")).catch(n=>{console.log(n.response)})}function P(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let r=0;r<e;r++){const s=Math.floor(Math.random()*t.length);n+=t.charAt(s)}return n}function v(e){e.parentElement.parentElement.style.display="none"}function b(e,t){let n=!1;return/^(?!.*\d{6,})(?!.*(.)\1{4,}).{6,12}$/.test(t)||(n=!0),e===c&&t!==l[0]?n=!0:e===a&&n===!1?l.push(t):l=[],n}function q(e){m.patch(f+`/users/${y}`,{password:`${e}`}).then(t=>{console.log(t.data),k()}).catch(t=>{console.log(t.response)})}function k(){setTimeout(()=>{window.location.href="http://localhost:5173/roomie/pages/login.html"},1e3)}w.addEventListener("click",async e=>{await d(o,o.value)&&(C(o.value.trim()),h.parentElement.parentElement.style.display="flex",v(o))});h.addEventListener("click",e=>{});E.addEventListener("click",async e=>{const t=a.value,n=c.value;await d(a,t)&&await d(c,n)&&q(t)});
