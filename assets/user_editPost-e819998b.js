import{a as d,S as $}from"./bootstrap.min-acd3fe77.js";const ce="https://roomie-lfta.onrender.com",le=localStorage.getItem("userId"),se=localStorage.getItem("token"),ie={headers:{Authorization:`Bearer ${se}`}};let N;const x=document.querySelectorAll(".nav-logged"),E=document.querySelectorAll(".nav-unlogged"),me=document.querySelectorAll(".nav-logged-photo"),fe=document.querySelector(".logout-btn");(async()=>{try{const e=`/600/users/${le}`,t=`${ce}${e}`,o=await d.get(t,ie),r=o.data.photo;me.forEach(a=>a.setAttribute("src",r)),N=o.data,de(),x.forEach(a=>{a.classList.remove("d-none")}),E.forEach(a=>{a.classList.add("d-none")})}catch(e){console.log(e),x.forEach(t=>{t.classList.add("d-none")}),E.forEach(t=>{t.classList.remove("d-none")})}})();function de(){localStorage.setItem("user",JSON.stringify(N))}fe.addEventListener("click",pe);function pe(){$.fire({icon:"question",title:"確定要登出嗎",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(e=>{e.isConfirmed&&(localStorage.removeItem("userId"),localStorage.removeItem("token"),localStorage.removeItem("user"),$.fire({icon:"success",title:"已登出",timer:1500,showConfirmButton:!1}),setTimeout(()=>{location.href="login.html"},1e3))})}const w="https://roomie-lfta.onrender.com",C=localStorage.getItem("userId"),F={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},m=document.querySelector("#cityRegion"),p=document.querySelector("#districtRegion"),k=document.querySelector("#pathRegion"),P=document.querySelector("#laneRegion"),T=document.querySelector("#alleyRegion"),V=document.querySelector("#numberRegion"),U=document.querySelector("#floors"),D=document.querySelector("#totalFloors"),he=document.querySelectorAll(".housingType"),R=document.querySelector("#articleTitle"),B=document.querySelector("#sizeofHouse"),H=document.querySelector("#layoutOfHouse"),ge=document.querySelectorAll(".equipmentItem"),z=document.querySelector("#rent"),Q=document.querySelector("#deposit"),Se=document.querySelectorAll(".billItem"),ye=document.querySelector("#managementBill"),f=document.querySelector("#manageFee"),M=document.querySelector("#minPeriod"),O=document.querySelector("#needPeople"),ve=document.querySelectorAll(".roommateItem"),qe=document.querySelectorAll(".sexStatus"),Ae=document.querySelectorAll(".petsStatus"),be=document.querySelectorAll(".cookStatus"),W=document.querySelector("#minAge"),_=document.querySelector("#maxAge"),Ie=document.querySelector("#datepicker"),$e=document.querySelectorAll(".lifeFunction"),xe=document.querySelector("#busStation"),Ee=document.querySelector("#mrtStation"),ke=document.querySelector("#trainStation"),Pe=document.querySelector("#hightSpeedStation"),l=document.querySelector("#somethingElse"),Te=document.querySelector("#wordLength"),Ve=document.querySelector(".fileUploaderOne"),Le=document.querySelector(".fileUploaderTwo"),Ne=document.querySelector(".fileUploaderThree"),we=document.querySelector(".fileUploaderFour"),Ce=document.querySelector(".fileUploaderFive"),Fe=document.querySelector("#contactName"),Ue=document.querySelectorAll(".contactSexStatus"),De=document.querySelector("#contactPhoneNumber"),Re=document.querySelector("#contactEmail"),Be=document.querySelector("#contactLine"),L=document.querySelectorAll(".contactForSuccess"),He=document.querySelector(".draftBtn"),ze=document.querySelector(".publishBtn"),Qe=document.querySelectorAll(".post-alert-message");let b,h=[],X="",i=[],s=[],g=[],j="",S=!1,y=!1,J="",v=[],q=[],K="",Y=[],u={},A=!1,I="";d.get("https://gist.githubusercontent.com/abc873693/2804e64324eaaf26515281710e1792df/raw/a1e1fc17d04b47c564bbd9dba0d59a6a325ec7c1/taiwan_districts.json").then(function(e){b=e.data.map(function(r){return{name:r.name,districts:r.districts.map(function(a){return a.name})}}).filter(r=>r.name!=="釣魚臺"&&r.name!=="南海島"),Me()});function Me(){let e="<option>縣市</option>";b.forEach(t=>{e+=`<option  value="${t.name}">${t.name}</option>`}),m.innerHTML=e}m.addEventListener("change",e=>{Oe(e.target.value)});function Oe(e){let t="<option>行政區</option>";b.forEach(o=>{o.name===e&&o.districts.forEach(r=>{t+=`<option  value="${r}">${r}</option>`})}),p.innerHTML=t}function n(e,t){const o=Array.from(Qe)[e];let r=o.children[0];if(t===""){o.style.display="none";return}o.style.display="flex",r.textContent=t}function We(){if(m.value===""||m.value==="縣市"||p.value===""||p.value==="行政區"||k.value.trim()===""||P.value.trim()==="")return n(0,"縣市、行政區、路段/街、巷皆須完整填寫!"),!1;n(0),h.push(p.value);let e=`${k.value}${P.value}`;return T.value!==""&&(e+=`${T.value}`),V.value!==""&&(e+=`${V.value}`),h.push(e),!0}function _e(){return U.value.trim()===""?(n(1,"樓層須填寫!"),!1):D.value.trim()===""?(n(1,"總樓層須填寫!"),!1):(n(1),!0)}function Xe(){const e=Array.from(he);let t=!1;return e.forEach(o=>{o.checked&&(X=o.nextElementSibling.textContent,t=!0)}),t?n(2):n(2,"請點選房屋類型!"),t}function je(){return R.value.trim()===""?(n(3,"QAQ標題呢"),!1):(n(3),!0)}function Je(){return B.value.trim()===""?(n(4,"坪數需填寫唷!"),!1):(n(4),!0)}function Ke(){return H.value.trim()===""?(n(5,"格局需填寫唷!"),!1):(n(5),!0)}function Ye(){const e=Array.from(ge);let t=!0;return e[e.length-1].checked===!0?(n(6),i.push("無"),t):(i=[],e.forEach(o=>{o.checked&&i.push(o.nextElementSibling.textContent)}),i.length===0?(n(6,"請勾選一下~(沒有則是勾無)"),t=!1):n(6),t)}function Ge(){return z.value.trim()===""?(n(7,"是上天派來的天使嗎!"),!1):Q.value==="押金"?(n(7,"要選一或兩個月唷~"),!1):(n(7),!0)}function Ze(){const e=Array.from(Se);let t=!0;return e[e.length-1].checked===!0?(n(8),s.push("無"),t):(s=[],e.forEach(o=>{o.checked&&s.push(o.nextElementSibling.textContent)}),s.length===0?(n(8,"請勾選一下~(沒有則是勾無)"),t=!1):n(8),t)}function et(){return s.some(t=>t==="管理費")?f.value.trim()===""?(n(9,"不填寫管委會會把你抓走!"),!1):isNaN(Number(f.value))?(n(9,"請填寫數字~"),!1):(n(9),!0):(n(9),!0)}function tt(){return M.value==="時間"?(n(10,"請填寫時間!"),!1):(n(10),!0)}function nt(){return O.value.trim()===""?(n(11,"都來找合租了沒有人數合理嗎QAQ"),!1):(n(11),!0)}function ot(){const e=Array.from(ve);return g=[],e.forEach(t=>{t.checked&&g.push(t.nextElementSibling.textContent)}),!0}function rt(){return Array.from(qe).forEach(t=>{t.checked&&(j=t.nextElementSibling.textContent)}),!0}function at(){const e=Array.from(Ae);return e.some(t=>t.checked)?(n(12),e[0].checked?S=!0:S=!1,!0):(n(12,"請點選可以/不行~"),!1)}function ut(){const e=Array.from(be);return e.some(t=>t.checked)?(n(13),e[0].checked?y=!0:y=!1,!0):(n(13,"請點選可以/不行~"),!1)}function ct(){const e=Number(W.value),t=Number(_.value);return isNaN(e)||isNaN(t)?(n(14,"請填寫數字~"),!1):e>t?(n(14,"從低到高填~"),!1):e<18||t>100?(n(14,"填18~100歲"),!1):(n(14),!0)}function lt(){const e=Ie.value.split("/");return e.length===1?(n(15,"總是要讓人知道日期吧!(握拳"),!1):(n(15),J=`${e[2]}/${e[1]}/${e[0]}`,!0)}function st(){const e=Array.from($e);return v=[],e.forEach(t=>{t.checked&&v.push(t.nextElementSibling.textContent)}),!0}function it(){return q=[],[xe,Ee,ke,Pe].forEach(t=>{t.value.trim()!==""&&q.push(`${t.value}${t.nextElementSibling.textContent}`)}),!0}function mt(){return K=l.value.trim(),!0}async function ft(){let e=[Ve,Le,Ne,we,Ce];return e.some(t=>t.files[0]===void 0)?(n(17,"不想讓大家看房間增加租客嗎!想嘛，所以請把五張照片發好發滿唷"),!1):(await Promise.all(e.map(async t=>{t.files[0]!==void 0&&t.files[0].type.startsWith("image/")&&await dt(t)})),n(17),!0)}function dt(e){return new Promise((t,o)=>{const r=e.files[0];let a=new FileReader;const c={};a.onload=ne=>{const oe=r.name,re=r.type,ae=ne.target.result.split(",")[1];c.fileName=oe,c.fileType=re,c.base64Data=ae,pt(c).then(()=>t()).catch(ue=>o(ue))},a.readAsDataURL(r)})}function pt(e){return new Promise((t,o)=>{d.post("https://script.google.com/macros/s/AKfycbySmWyqFenx525ANUQtipn-TwPUDdThAWhaXkcCrfyS5nAeAqdo_I3kprq6H5zUTXzI/exec",e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(r){console.log();const a=r.data.split("file/d/")[1].split("/view?")[0];Y.push(`https://drive.google.com/uc?export=view&id=${a}`),t()}).catch(function(r){console.log(r),o(r)})})}function ht(){const e=Fe.value.trim(),t=Array.from(Ue);let o=[];return e===""||!t.some(r=>r.checked)?(n(18,"這樣如何叫你啦?"),!1):e.split("").length>2?(n(18,"填姓氏不是名字!"),!1):(n(18),o.push(e),t.forEach(r=>{r.checked&&o.push(r.nextElementSibling.textContent)}),u.person=o,!0)}function gt(){const e=De.value.trim();return e===""?(n(19,"請留下電話QAQ(跪"),!1):(n(19),u.phone=e,!0)}function St(){const e=Re.value.trim();return e===""?(n(20,"發送前請留下信箱吧!"),!1):(n(20),u.email=e,!0)}function yt(){const e=Be.value.trim();return u.line=e,!0}function vt(){if(!Array.from(L).some(e=>e.checked)){n(21,"不同意沒關係 真的沒關係，但還是要點唷");return}return Array.from(L).forEach(e=>{e.checked&&(e.nextElementSibling.textContent==="同意"?A=!0:A=!1)}),n(21),!0}ze.addEventListener("click",async e=>{await G()===!0&&(I="刊登中",Z(),ee(),te())});He.addEventListener("click",async e=>{await G()===!0&&(I="草稿",Z(),ee(),te())});async function G(){let e=[];if(e.push(We()),e.push(_e()),e.push(Xe()),e.push(je()),e.push(Je()),e.push(Ke()),e.push(Ye()),e.push(Ge()),e.push(Ze()),e.push(et()),e.push(tt()),e.push(nt()),e.push(ot()),e.push(rt()),e.push(at()),e.push(ut()),e.push(ct()),e.push(lt()),e.push(st()),e.push(it()),e.push(mt()),e.push(await ft()),e.push(ht()),e.push(gt()),e.push(St()),e.push(yt()),e.push(vt()),e.every(t=>t===!0))return!0}ye.addEventListener("click",e=>{if(!e.target.checked){f.setAttribute("disabled","disabled");return}f.removeAttribute("disabled")});l.addEventListener("input",e=>{let t=l.value.split("").length;const o=500;if(t>o){l.value=l.value.substring(0,o),n(16,"字數已達標，斟酌一下啦(拜託");return}else n(16),Te.textContent=l.value.split("").length});function qt(){const e=new Date,t=e.getFullYear(),o=e.getMonth()+1,r=e.getDate(),a=e.getHours(),c=e.getMinutes();return`${t}/${o}/${r} ${a}:${c}`}function Z(){const e={userId:Number(C),status:`${I}`,updateDate:`${qt()}`,soldDate:"",view:0,address:`${m.value}`,district:h,floor:Number(U.value.trim()),totalFloor:Number(D.value.trim()),type:`${X}`,title:`${R.value.trim()}`,"square Footage":Number(B.value.trim()),houseLayout:`${H.value.trim()}`,equipment:i,price:Number(z.value.trim()),deposit:`${Q.value}`,priceInclude:s,manageFee:Number(f.value.trim()),minPeriod:`${M.value}`,needPartner:Number(O.value.trim()),identity:g,gender:`${j}`,canPet:S,canCooking:y,minAge:Number(W.value.trim()),maxAge:Number(_.value.trim()),moveInDate:`${J}`,lifeEquipment:v,traffic:q,intro:`${K}`,photo:Y,agreePublish:A};d.post(`${w}/600/rents`,e,F).then(t=>{console.log(t.data)}).catch(t=>{console.log(t.response)})}function ee(){let e={person:[`${u.person[0]}`,`${u.person[1]}`],phone:`${u.phone}`,email:`${u.email}`,line:`${u.line}`};d.patch(`${w}/600/users/${C}`,{contact:e},F).then(t=>{console.log(t.data)}).catch(t=>{console.log(t.response)})}function te(){setTimeout(()=>{window.location.href="https://uli1313.github.io/roomie/user_posts.html"},3e3)}
