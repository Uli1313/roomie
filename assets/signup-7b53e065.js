import{a as f}from"./bootstrap.min-f14bc68a.js";import"./transform-18031762.js";const v="https://roomie-lfta.onrender.com",x=localStorage.getItem("userId"),L=localStorage.getItem("token"),k={headers:{Authorization:`Bearer ${L}`}};let S;const p=document.querySelectorAll(".nav-logged"),y=document.querySelectorAll(".nav-unlogged"),w=document.querySelectorAll(".nav-logged-photo");(async()=>{try{const e=`/600/users/${x}`,t=`${v}${e}`,o=await f.get(t,k),n=o.data.photo;w.forEach(r=>r.setAttribute("src",n)),S=o.data,U(),p.forEach(r=>{r.classList.remove("d-none")}),y.forEach(r=>{r.classList.add("d-none")}),console.log("已登入")}catch(e){console.log(e),p.forEach(t=>{t.classList.add("d-none")}),y.forEach(t=>{t.classList.remove("d-none")}),console.log("未登入")}})();function U(){localStorage.setItem("user",JSON.stringify(S))}const C="https://roomie-lfta.onrender.com",I=document.querySelector(".confirmEmail"),i=document.querySelector("#inputEmail"),g=document.querySelector("#inputPassword"),h=document.querySelector("#inputConfirmPassword"),a=document.querySelector("#rulesChecked"),b=document.querySelector("#inputSecurityCode"),l=document.querySelector(".confirmSecurityCode");let u=[],s=[],m;function d(e,t){const o=t.trim();return o===""?(c(e,"請勿空白!"),!1):e===i&&$(o.split("@"))?(c(e,"請填寫正確信箱!"),!1):(e===g||e===h)&&q(e,o)?(c(e,"請填寫正確密碼!"),!1):(e.parentElement.children[2].style.display="none",o)}function c(e,t){e.parentElement.children[2].style.display="flex",e.parentElement.children[2].children[0].children[0].textContent=`${t}`}function q(e,t){let o=!1;return/^(?!.*\d{6,})(?!.*(.)\1{4,}).{6,12}$/.test(t)||(o=!0),e===h&&t!==u[0]?o=!0:e===g&&o===!1?u.push(t):u=[],o}function $(e){const t=["gmail.com","yahoo.com.tw"];let o=!1;function n(){for(let r=0;r<t.length;r++)if(t[r]===e[1])return!1;return!0}return(e.length!==2||e.some(r=>r==="")||n())&&(o=!0),o}async function A(e){try{const o=(await f.get(C+"/users")).data;let n=!0;return o.forEach(r=>{r.email===e&&(c(i,"這個帳號已經註冊過"),n=!1)}),n}catch(t){return console.error("Error fetching user information:",t),!1}}function P(e){const t=e[0];m=T(5);let o=`使用者:Email:${t}<br/>驗證碼:${m}<br/>Messages:申請註冊roomie會員<br/> `;Email.send({SecureToken:"64af44cb-e8aa-46d2-9138-00053a70aca2",To:`${t}`,From:"roomie0921@gmail.com",Subject:"親愛的會員您好，Roomie客服中心寄送驗證碼來囉~",Body:o}).then(n=>alert("已傳送驗證碼到信箱")).catch(n=>{console.log(n.response)})}function T(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let o="";for(let n=0;n<e;n++){const r=Math.floor(Math.random()*t.length);o+=t.charAt(r)}return o}function E(e){l.nextElementSibling.style.display="flex",e?(l.nextElementSibling.textContent="註冊成功",l.nextElementSibling.style.color="green"):(l.nextElementSibling.textContent="驗證失敗",l.nextElementSibling.style.color="red")}function B(){setTimeout(()=>{window.location.href="https://uli1313.github.io/roomie/login.html"},1e3)}function M(e){f.post(C+"/users",{email:`${e[0]}`,password:`${e[1]}`,name:"",nickname:"",gender:"",photo:"https://i.imgur.com/rUTLxZC.jpg",contact:{person:["",""],phone:"",email:"",line:""},about:""}).then(t=>{console.log(t.data),B()}).catch(t=>{console.log(t.response)})}I.addEventListener("click",async e=>{const t=[i,g,h];s=[];for(const o of t)if(o===i){const n=d(o,o.value);typeof d(o,o.value)=="string"&&await A(n)&&s.push(n)}else d(o,o.value)&&s.push(o.value.trim());a.checked?(a.parentElement.children[2].style.display="none",s.push(a.checked)):c(a,"閱讀完請勾選"),s.length===4&&(b.parentElement.style.display="flex",P(s))});l.addEventListener("click",e=>{b.value===m?(E(!0),M(s)):E(!1)});
