import"./bootstrap.min-340b141d.js";import{a as p}from"./axios-28bc18a3.js";const y="https://roomie-lfta.onrender.com/";let t="",d=[];function H(s){let a=document.querySelector("#list"),r="";s.forEach(function(n){const g=`${n.updateDate}`,k=new Date(g),x=`${n.soldDate}`,$=new Date(x),_=new Date,v=k.getTime()-$.getTime(),i=$.getTime()-_.getTime(),L=Math.abs(Math.trunc(v/(1e3*3600*24))),e=Math.abs(Math.trunc(i/(1e3*3600*24)));r+=`<div class="col-12 my-3 p-1 hover-primary-2 rounded">
                    <div class="col-12 p-3 bg-white d-flex flex-wrap justify-content-evenly align-items-center text-end text-lg-center border rounded">
                        <div class="col-12 col-lg-4"><a href="matchArticle.html?id=${n.id}" class="link-dark fw-bold">${n.title}</a></div>
                        <div class="col-12 col-lg pb-1 pb-lg-0"><span class="text-primary">${e}日前&nbsp;</span>媒合成功</div>
                        <div class="col-12 col-lg pb-1 pb-lg-0">${n["square Footage"]}坪&nbsp;/&nbsp;${n.type}</div>
                        <div class="col-12 col-lg fw-bold text-primary">${n.price.toLocaleString("zh-TW")}元/月</div>
                        <div class="col-12 col-lg">
                            <span class="text-primary">花費${L}日&nbsp;</span>
                            媒合成功
                            <span class="material-symbols-outlined ps-1 text-danger" style="transform: translateY(24%);">verified</span>
                        </div>
                    </div>
                </div>
                `}),a.innerHTML=r,Y()}function S(){let s=document.querySelector("#list"),a=`
                <div class="row rounded">
                    <div class="col bg-white rounded m-5 p-5 d-flex flex-column justify-content-center align-items-center ">
                        <p>¯_(ツ)_/¯</p>
                        <p class="p-2 h5">對不起，沒有找到適合您的物件！</p>
                        <p>建議您：重新篩選或搜尋試試看唷～</p>
                    </div>
                </div>`;s.innerHTML=a}function j(){t="_sort=view&_order=desc&status=已媒合",p.get(`${y}rents?${t}`).then(function(s){d=s.data,b(t,c,f),u(d)})}j();let O=document.querySelector("#filterDate"),F=document.querySelector("#filterPrice"),h="&_sort=soldDate&_order=asc",w="&_sort=soldDate&_order=desc",m="&_sort=price&_order=asc",C="&_sort=price&_order=desc",D="_sort=view&_order=desc";function I(){O.addEventListener("click",function(s){t.includes(h)?t=t.replace(h,w):t.includes(w)?t=t.replace(w,h):t.includes(m)?t=t.replace(m,h):t.includes(C)?t=t.replace(C,h):t.includes(D)?t=t.replace(D,h):t+=h,p.get(`${y}rents?${t}`).then(function(a){d=a.data,d.length>0?(b(t,1,f),c=1,u(d)):(S(),c=1,u(d))})})}I();function V(){F.addEventListener("click",function(s){t.includes(m)?t=t.replace(m,C):t.includes(C)?t=t.replace(C,m):t.includes(h)?t=t.replace(h,m):t.includes(w)?t=t.replace(w,m):t.includes(D)?t=t.replace(D,m):t+=m,p.get(`${y}rents?${t}`).then(function(a){d=a.data,d.length>0?(b(t,1,f),c=1,u(d)):(S(),c=1,u(d))})})}V();let E,T,f=4,c=1,M=document.querySelector(".pagination");function b(s,a,r){p.get(`${y}rents?${s}&_page=${a}&_limit=${r}`).then(n=>{let g=n.data;H(g)})}function u(s){E=s.length,T=Math.ceil(E/f);let a="";if(E==0)a="";else{a+=`<li class="page-item">
        <a class="page-link" href="#" aria-label="Previous">
            <span class="material-icons align-bottom">
            chevron_left
            </span>
        </a>
        </li>`;for(let n=1;n<=T;n++)a+=`<li class="page-item">
            <a class="page-link" href="#">${n}</a>
        </li>`;a+=`<li class="page-item">
        <a class="page-link" href="#" aria-label="Next">
            <span class="material-icons"> navigate_next </span>
        </a>
        </li>`}M.innerHTML=a;const r=document.querySelectorAll(".page-link");r.forEach(n=>{(n.textContent.trim()==="chevron_left"||n.textContent.trim()==="navigate_next")&&n.blur()}),r[c].classList.add("active")}M.addEventListener("click",s=>{const a=document.querySelectorAll(".page-link");if(a.forEach(r=>{r.classList.remove("active")}),s.target.textContent.trim()==="chevron_left"){if(c===1){a[c].classList.add("active"),s.preventDefault();return}c>1&&(c--,a[c].classList.add("active"),b(t,c,f))}else if(s.target.textContent.trim()==="navigate_next"){if(c===T){a[c].classList.add("active"),s.preventDefault();return}c<T&&(c++,a[c].classList.add("active"),b(t,c,f))}else c=Number(s.target.textContent.trim()),a[c].classList.add("active"),b(t,c,f)});let z=document.querySelector("#search"),B=document.querySelector("#submit");B.addEventListener("click",function(s){let r=`q=${z.value}&status=已媒合`;p.get(`${y}rents?${r}`).then(function(n){let g=n.data;g.length>0?(b(r,c,f),u(g)):S()})});p.get("https://gist.githubusercontent.com/abc873693/2804e64324eaaf26515281710e1792df/raw/a1e1fc17d04b47c564bbd9dba0d59a6a325ec7c1/taiwan_districts.json").then(function(s){let a=s.data,n=a.map(function(e){return{name:e.name,districts:e.districts.map(function(q){return q.name})}}).filter(e=>e.name!=="釣魚臺"&&e.name!=="南海島");function g(e,q){const l=["臺北市","新北市","基隆市","桃園市","新竹市","新竹縣","臺中市","彰化縣","苗栗縣","南投縣","雲林縣","高雄市","臺南市","嘉義市","嘉義縣","屏東縣","宜蘭縣","花蓮縣","臺東縣","澎湖縣","金門縣","連江縣"];return l.indexOf(e.name)-l.indexOf(q.name)}n.sort(g);let k=document.querySelectorAll(".countyCity"),x=document.querySelector(".btnTitle"),$=document.querySelector(".dropdownTitle"),_=document.querySelector(".districtList");document.querySelectorAll(".form-check-input"),k.forEach(function(e){e.addEventListener("change",function(q){document.querySelector("#disabled-events").classList.remove("disabled-events");let l=Array.from(k).indexOf(e),o=n[l],R=`${o.name}`,U=`${o.name}`,P="";o.districts.forEach(function(N,A){P+=` 
                                        <li class="pb-2">
                                            <div class="form-check-inline cursor">
                                                <input class="form-check-input cursor districtCheckbox" type="checkbox" id="district${A}" value="${o.name}">
                                                <label class="form-check-label cursor districtLabelText" for="district${A}">${N}</label>
                                            </div>
                                        </li>
                                        `}),x.textContent=R,$.textContent=U,_.innerHTML=P,document.querySelectorAll(".form-check-input")})});let v=document.querySelector("#row"),i="",L="";v.addEventListener("change",function(e){const l=document.querySelector(`label[for='${e.target.id}']`).textContent.trim();e.target.checked?(e.target.type==="radio"&&e.target.classList.contains("cityRadio")?i=`address_like=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("districtCheckbox")?i+=`&district_like=${l}`:e.target.type==="radio"&&e.target.classList.contains("priceRadio")?L=`&${e.target.dataset.price}&_sort=price&_order=desc`:e.target.type==="checkbox"&&e.target.classList.contains("houseCheckbox")?i+=`&type=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("lifeEquipmentCheckbox")?i+=`&lifeEquipment_like=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("equipmentCheckbox")?i+=`&equipment_like=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("identityCheckbox")?i+=`&identity_like=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("genderCheckbox")?i+=`&gender=${l}`:e.target.type==="checkbox"&&e.target.classList.contains("canPetCookCheckbox")&&(l=="可開伙"?i+=`&canCooking=${!0}`:i+=`&canPet=${!0}`),t=i+L+"&status=已媒合",p.get(`${y}rents?${t}`).then(function(o){o.data.length>0?(a=o.data,b(t,1,f),c=1,u(a)):(a=o.data,S(),c=1,u(a))})):(e.target.type==="radio"&&e.target.classList.contains("cityRadio")?i=i.replace(`address_like=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("districtCheckbox")?i=i.replace(`&district_like=${l}`,""):e.target.type==="radio"&&e.target.classList.contains("priceRadio")?L=i.replace(`&${e.target.dataset.price}`,""):e.target.type==="checkbox"&&e.target.classList.contains("houseCheckbox")?i=i.replace(`&type=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("lifeEquipmentCheckbox")?i=i.replace(`&lifeEquipment_like=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("equipmentCheckbox")?i=i.replace(`&equipment_like=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("identityCheckbox")?i=i.replace(`&identity_like=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("genderCheckbox")?i=i.replace(`&gender=${l}`,""):e.target.type==="checkbox"&&e.target.classList.contains("canPetCookCheckbox")&&(l=="可開伙"?i=i.replace(`&canCooking=${!0}`,""):i=i.replace(`&canPet=${!0}`,"")),t=i+L+"&status=已媒合",p.get(`${y}rents?${t}`).then(function(o){o.data.length>0?(a=o.data,b(t,1,f),c=1,u(a)):(a=o.data,S(),c=1,u(a))}))})});let W=document.querySelector("#close");W.addEventListener("click",function(s){location.reload()});function Y(){document.querySelectorAll(".link-title").forEach(a=>{a.addEventListener("click",function(r){r.preventDefault();const n=new URL(r.target.href),k=new URLSearchParams(n.search).get("id");p.get(`${y}rents/${k}`).then(function(x){const $=x.data;let _={view:parseInt($.view)+1};p.patch(`${y}rents/${k}`,_).then(function(v){window.location.href=r.target.href}).catch(function(v){console.error(v)})}).catch(function(x){console.error(x)})})})}
