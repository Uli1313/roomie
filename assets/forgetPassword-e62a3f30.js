import{a as f}from"./bootstrap.min-f14bc68a.js";const S="https://roomie-lfta.onrender.com",L=localStorage.getItem("userId"),I=localStorage.getItem("token"),P={headers:{Authorization:`Bearer ${I}`}};let y;const g=document.querySelectorAll(".nav-logged"),h=document.querySelectorAll(".nav-unlogged"),k=document.querySelectorAll(".nav-logged-photo");(async()=>{try{const e=`/600/users/${L}`,t=`${S}${e}`,o=await f.get(t,P),r=o.data.photo;k.forEach(n=>n.setAttribute("src",r)),y=o.data,q(),g.forEach(n=>{n.classList.remove("d-none")}),h.forEach(n=>{n.classList.add("d-none")}),console.log("已登入")}catch(e){console.log(e),g.forEach(t=>{t.classList.add("d-none")}),h.forEach(t=>{t.classList.remove("d-none")}),console.log("未登入")}})();function q(){localStorage.setItem("user",JSON.stringify(y))}const E="https://roomie-lfta.onrender.com",$=document.querySelector(".confirmEmail"),l=document.querySelector("#inputEmail"),x=document.querySelector("#inputSecurityCode"),s=document.querySelector("#securityCodeBtn"),a=document.querySelector("#inputPassword"),c=document.querySelector("#inputConfirmPassword"),v=document.querySelector("#resetPasswordBtn");let w,u,i=[];async function m(e,t){const o=t.trim();return o===""?(d(e,"請勿空白!"),!1):e===l&&await U(o)?(d(e,"這個帳號尚未註冊過"),!1):(e===a||e===c)&&T(e,o)?(d(e,"請填寫正確密碼!"),!1):(e.parentElement.children[2].style.display="none",!0)}function d(e,t){e.parentElement.children[2].style.display="flex",e.parentElement.children[2].children[0].children[0].textContent=`${t}`}async function U(e){try{const o=(await f.get(E+"/users")).data;let r=!1;const n=o.filter(C=>C.email===e);return n.length===1?w=n[0].id:r=!0,r}catch(t){console.error("Error fetching user information:",t)}}function A(e){u=B(5);let t=`使用者:Email:${e}<br/>驗證碼:${u}<br/>Messages:roomie會員忘記密碼，需要重新設定<br/> `;Email.send({SecureToken:"64af44cb-e8aa-46d2-9138-00053a70aca2",To:e,From:"roomie0921@gmail.com",Subject:"親愛的會員您好，Roomie客服中心寄送驗證碼來囉~",Body:t}).then(o=>alert("已傳送驗證碼到信箱")).catch(o=>{console.log(o.response)})}function B(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let o="";for(let r=0;r<e;r++){const n=Math.floor(Math.random()*t.length);o+=t.charAt(n)}return o}function p(e){s.parentElement.previousElementSibling.style.display="flex",e||(s.parentElement.previousElementSibling.textContent="驗證失敗",s.parentElement.previousElementSibling.style.color="red")}function b(e){e.parentElement.parentElement.style.display="none"}function T(e,t){let o=!1;return/^(?!.*\d{6,})(?!.*(.)\1{4,}).{6,12}$/.test(t)||(o=!0),e===c&&t!==i[0]?o=!0:e===a&&o===!1?i.push(t):i=[],o}function M(e){f.patch(E+`/users/${w}`,{password:`${e}`}).then(t=>{console.log(t.data),F()}).catch(t=>{console.log(t.response)})}function F(){setTimeout(()=>{window.location.href="https://uli1313.github.io/roomie/login.html"},1e3)}$.addEventListener("click",async e=>{await m(l,l.value)&&(A(l.value.trim()),s.parentElement.parentElement.style.display="flex",b(l))});s.addEventListener("click",e=>{x.value===u?(p(!0),b(s),v.parentElement.parentElement.style.display="block"):p(!1)});v.addEventListener("click",async e=>{const t=a.value,o=c.value;await m(a,t)&&await m(c,o)&&M(t)});
