import"./bootstrap.min-340b141d.js";import{a as r}from"./axios-28bc18a3.js";import{S as I}from"./sweetalert2.all-ae5fa1cb.js";const c="https://roomie-lfta.onrender.com",l=localStorage.getItem("userId"),U=localStorage.getItem("token"),b={headers:{Authorization:`Bearer ${U}`}},v=document.querySelector("#nickName"),p=document.querySelector("#name"),f=document.querySelector("#genderMale"),w=document.querySelector("#genderFemal");function B(){C(),L()}B();let n;async function C(){try{const e=`/600/users/${l}`,t=`${c}${e}`;n=(await r.get(t,b)).data,P(),N()}catch(e){console.log(e),(e.response.status===401||e.response.statusText==="Unauthorized")&&["user.html","user_posts.html","user_favorites.html","user_messages.html"].some(o=>location.pathname.match(o))&&I.fire({icon:"warning",title:"請重新登入",scrollbarPadding:!1,didClose:()=>{F(),location.href="login.html"}})}}function P(){localStorage.setItem("user",JSON.stringify(n))}function D(){const e=localStorage.getItem("user");e&&(n=JSON.parse(e),N())}D();function N(){v&&p&&f&&w&&(v.value=n.nickname,p.value=n.name,document.getElementById("userNickName").textContent=n.nickname,document.getElementById("userEmail").textContent=n.email,document.getElementById("signupEmail").value=n.email,n.gender==="male"?f.checked=!0:w.checked=!0)}const S=document.querySelector(".infoEdit-btn"),y=document.querySelector(".infoSave-btn"),x=document.querySelectorAll(".editable-input"),$=document.querySelector("#aboutMe"),E=(e,t,o)=>{e.forEach(a=>{a[t?"setAttribute":"removeAttribute"]("readonly",t),a.value=a.value.trim()}),f.disabled=o,w.disabled=o,$.readOnly=t},T=async(e,t=!1)=>{try{const o=await r.patch(`${c}/users/${l}`,e);return!t&&I.fire({scrollbarPadding:!1,icon:"success",title:"修改成功",showCancelButton:!1,timer:1500}),o.data}catch(o){throw console.error(o),o}};S.addEventListener("click",e=>{e.preventDefault(),E(x,!1,!1),S.classList.add("d-none"),y.classList.remove("d-none")});y.addEventListener("click",async e=>{e.preventDefault(),E(x,!0,!0);const t={nickname:v.value.trim(),name:p.value.trim(),gender:f.checked?"male":"female",about:$.value.trim()},o=await T(t);n={...n,...o},P(),S.classList.remove("d-none"),y.classList.add("d-none")});let u=[],d=[],m=[];function L(){r.get(`${c}/rents?userId=${l}`).then(e=>{u=e.data,h(u,d,m)}).catch(e=>{console.log(e)}),r.get(`${c}/favorites?userId=${l}`).then(e=>{d=e.data,h(u,d,m)}).catch(e=>{console.log(e)}),r.get(`${c}/qas?userId=${l}`).then(e=>{m=e.data,h(u,d,m)}).catch(e=>{console.log(e)})}L();const z=document.querySelector(".postsNum"),A=document.querySelector(".favsNum"),M=document.querySelector(".commentsNum");function h(e,t,o){z.textContent=e.length,A.textContent=t.length,M.textContent=o.length}const k=document.querySelector("#changePwdForm");k.addEventListener("submit",e=>{e.preventDefault(),_()});function V(e){r.patch(`${c}/600/users/${l}`,{password:e},b).then(t=>{k.reset(),I.fire({icon:"success",title:"變更密碼成功",showConfirmButton:!1,timer:1500,didClose:()=>{F(),location.href="login.html"}}),k.classList.remove("was-validated")}).catch(t=>{console.log(t)})}function _(){const e=document.querySelector("#nowPwd"),t=document.querySelector("#setNewPwd"),o=document.querySelector("#rePwd"),a=e.value.trim(),s=t.value.trim(),g=o.value.trim();if(a===""?i(e,"欄位不得為空"):q(e),s===""?i(t,"欄位不得為空"):j(s)||J(s)?i(t,"密碼不安全"):q(t),g==="")i(o,"欄位不得為空");else if(s!==g)i(o,"密碼不一致");else if(s===g){V(s);return}}function i(e,t){const o=e.parentElement,a=o.querySelector(".invalid-feedback");a.innerText=t,o.classList.add("was-validated")}function q(e){e.parentElement.classList.add("was-validated")}function j(e){return/123456|234567|345678|456789|567890|abcdefghijklmnopqrstuvwxyz|zyxwvutsrqponmlkjihgfedcba/i.test(e)}function J(e){return e.length<6}function F(){localStorage.removeItem("token"),localStorage.removeItem("userId")}
