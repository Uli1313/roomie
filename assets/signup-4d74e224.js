import{a as f,S as p}from"./bootstrap.min-b3783de9.js";import"./transform-18031762.js";const x="https://roomie-lfta.onrender.com",w=localStorage.getItem("userId"),I=localStorage.getItem("token"),k={headers:{Authorization:`Bearer ${I}`}};let v;const y=document.querySelectorAll(".nav-logged"),E=document.querySelectorAll(".nav-unlogged"),L=document.querySelectorAll(".nav-logged-photo"),q=document.querySelector(".logout-btn");(async()=>{try{const e=`/600/users/${w}`,t=`${x}${e}`,o=await f.get(t,k),n=o.data.photo;L.forEach(r=>r.setAttribute("src",n)),v=o.data,U(),y.forEach(r=>{r.classList.remove("d-none")}),E.forEach(r=>{r.classList.add("d-none")})}catch(e){console.log(e),y.forEach(t=>{t.classList.add("d-none")}),E.forEach(t=>{t.classList.remove("d-none")})}})();function U(){localStorage.setItem("user",JSON.stringify(v))}q.addEventListener("click",$);function $(){p.fire({icon:"question",title:"確定要登出嗎",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(e=>{e.isConfirmed&&(localStorage.removeItem("userId"),localStorage.removeItem("token"),localStorage.removeItem("user"),p.fire({icon:"success",title:"已登出",timer:1500,showConfirmButton:!1}),setTimeout(()=>{location.href="login.html"},1e3))})}const C="https://roomie-lfta.onrender.com",A=document.querySelector(".confirmEmail"),i=document.querySelector("#inputEmail"),g=document.querySelector("#inputPassword"),h=document.querySelector("#inputConfirmPassword"),a=document.querySelector("#rulesChecked"),b=document.querySelector("#inputSecurityCode"),s=document.querySelector(".confirmSecurityCode");let u=[],l=[],d;function m(e,t){const o=t.trim();return o===""?(c(e,"請勿空白!"),!1):e===i&&T(o.split("@"))?(c(e,"請填寫正確信箱!"),!1):(e===g||e===h)&&B(e,o)?(c(e,"請填寫正確密碼!"),!1):(e.parentElement.children[2].style.display="none",o)}function c(e,t){e.parentElement.children[2].style.display="flex",e.parentElement.children[2].children[0].children[0].textContent=`${t}`}function B(e,t){let o=!1;return/^(?!.*\d{6,})(?!.*(.)\1{4,}).{6,12}$/.test(t)||(o=!0),e===h&&t!==u[0]?o=!0:e===g&&o===!1?u.push(t):u=[],o}function T(e){const t=["gmail.com","yahoo.com.tw"];let o=!1;function n(){for(let r=0;r<t.length;r++)if(t[r]===e[1])return!1;return!0}return(e.length!==2||e.some(r=>r==="")||n())&&(o=!0),o}async function P(e){try{const o=(await f.get(C+"/users")).data;let n=!0;return o.forEach(r=>{r.email===e&&(c(i,"這個帳號已經註冊過"),n=!1)}),n}catch(t){return console.error("Error fetching user information:",t),!1}}function M(e){const t=e[0];d=j(5);let o=`使用者:Email:${t}<br/>驗證碼:${d}<br/>Messages:申請註冊roomie會員<br/> `;Email.send({SecureToken:"64af44cb-e8aa-46d2-9138-00053a70aca2",To:`${t}`,From:"roomie0921@gmail.com",Subject:"親愛的會員您好，Roomie客服中心寄送驗證碼來囉~",Body:o}).then(n=>alert("已傳送驗證碼到信箱")).catch(n=>{console.log(n.response)})}function j(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let o="";for(let n=0;n<e;n++){const r=Math.floor(Math.random()*t.length);o+=t.charAt(r)}return o}function S(e){s.nextElementSibling.style.display="flex",e?(s.nextElementSibling.textContent="註冊成功",s.nextElementSibling.style.color="green"):(s.nextElementSibling.textContent="驗證失敗",s.nextElementSibling.style.color="red")}function R(){setTimeout(()=>{window.location.href="https://uli1313.github.io/roomie/login.html"},1e3)}function z(e){f.post(C+"/users",{email:`${e[0]}`,password:`${e[1]}`,name:"",nickname:"",gender:"",photo:"https://i.imgur.com/rUTLxZC.jpg",contact:{person:["",""],phone:"",email:"",line:""},about:""}).then(t=>{console.log(t.data),R()}).catch(t=>{console.log(t.response)})}A.addEventListener("click",async e=>{const t=[i,g,h];l=[];for(const o of t)if(o===i){const n=m(o,o.value);typeof m(o,o.value)=="string"&&await P(n)&&l.push(n)}else m(o,o.value)&&l.push(o.value.trim());a.checked?(a.parentElement.children[2].style.display="none",l.push(a.checked)):c(a,"閱讀完請勾選"),l.length===4&&(b.parentElement.style.display="flex",M(l))});s.addEventListener("click",e=>{b.value===d?(S(!0),z(l)):S(!1)});
