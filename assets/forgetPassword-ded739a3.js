import{a as f,S as g}from"./bootstrap.min-ee9b3e4d.js";const I="https://roomie-lfta.onrender.com",L=localStorage.getItem("userId"),k=localStorage.getItem("token"),q={headers:{Authorization:`Bearer ${k}`}};let E;const h=document.querySelectorAll(".nav-logged"),p=document.querySelectorAll(".nav-unlogged"),B=document.querySelectorAll(".nav-logged-photo"),P=document.querySelector(".logout-btn");(async()=>{try{const e=`/600/users/${L}`,t=`${I}${e}`,o=await f.get(t,q),r=o.data.photo;B.forEach(n=>n.setAttribute("src",r)),E=o.data,x(),h.forEach(n=>{n.classList.remove("d-none")}),p.forEach(n=>{n.classList.add("d-none")})}catch(e){console.log(e),h.forEach(t=>{t.classList.add("d-none")}),p.forEach(t=>{t.classList.remove("d-none")})}})();function x(){localStorage.setItem("user",JSON.stringify(E))}P.addEventListener("click",$);function $(){g.fire({icon:"question",title:"確定要登出嗎",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(e=>{e.isConfirmed&&(localStorage.removeItem("userId"),localStorage.removeItem("token"),localStorage.removeItem("user"),g.fire({icon:"success",title:"已登出",timer:1500,showConfirmButton:!1}),setTimeout(()=>{location.href="login.html"},1e3))})}const v="https://roomie-lfta.onrender.com",T=document.querySelector(".confirmEmail"),l=document.querySelector("#inputEmail"),U=document.querySelector("#inputSecurityCode"),s=document.querySelector("#securityCodeBtn"),a=document.querySelector("#inputPassword"),c=document.querySelector("#inputConfirmPassword"),w=document.querySelector("#resetPasswordBtn");let S,d,i=[];async function m(e,t){const o=t.trim();return o===""?(u(e,"請勿空白!"),!1):e===l&&await A(o)?(u(e,"這個帳號尚未註冊過"),!1):(e===a||e===c)&&R(e,o)?(u(e,"請填寫正確密碼!"),!1):(e.parentElement.children[2].style.display="none",!0)}function u(e,t){e.parentElement.children[2].style.display="flex",e.parentElement.children[2].children[0].children[0].textContent=`${t}`}async function A(e){try{const o=(await f.get(v+"/users")).data;let r=!1;const n=o.filter(b=>b.email===e);return n.length===1?S=n[0].id:r=!0,r}catch(t){console.error("Error fetching user information:",t)}}function M(e){d=F(5);let t=`使用者:Email:${e}<br/>驗證碼:${d}<br/>Messages:roomie會員忘記密碼，需要重新設定<br/> `;Email.send({SecureToken:"64af44cb-e8aa-46d2-9138-00053a70aca2",To:e,From:"roomie0921@gmail.com",Subject:"親愛的會員您好，Roomie客服中心寄送驗證碼來囉~",Body:t}).then(o=>alert("已傳送驗證碼到信箱")).catch(o=>{console.log(o.response)})}function F(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let o="";for(let r=0;r<e;r++){const n=Math.floor(Math.random()*t.length);o+=t.charAt(n)}return o}function y(e){s.parentElement.previousElementSibling.style.display="flex",e||(s.parentElement.previousElementSibling.textContent="驗證失敗",s.parentElement.previousElementSibling.style.color="red")}function C(e){e.parentElement.parentElement.style.display="none"}function R(e,t){let o=!1;return/^(?!.*\d{6,})(?!.*(.)\1{4,}).{6,12}$/.test(t)||(o=!0),e===c&&t!==i[0]?o=!0:e===a&&o===!1?i.push(t):i=[],o}function j(e){f.patch(v+`/users/${S}`,{password:`${e}`}).then(t=>{console.log(t.data),z()}).catch(t=>{console.log(t.response)})}function z(){setTimeout(()=>{window.location.href="https://uli1313.github.io/roomie/login.html"},1e3)}T.addEventListener("click",async e=>{await m(l,l.value)&&(M(l.value.trim()),s.parentElement.parentElement.style.display="flex",C(l))});s.addEventListener("click",e=>{U.value===d?(y(!0),C(s),w.parentElement.parentElement.style.display="block"):y(!1)});w.addEventListener("click",async e=>{const t=a.value,o=c.value;await m(a,t)&&await m(c,o)&&j(t)});
